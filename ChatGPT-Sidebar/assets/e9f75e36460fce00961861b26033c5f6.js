import{B as Q}from"./72fd4ee2d5a3adb51faedc97ae5209b5.js";import{d as H,o as X}from"./3178c8329fb7343c4a8df5c5d4b8f2f2.js";import{C as M}from"./86e8490f22d5ffaff40ca5879db6ec11.js";import{d as ee}from"./e89f80fef20b267b41c7f233de7c44bc.js";import{M as te}from"./658cf16f1475fd823ea3f6b38f5982b1.js";import{m as ie}from"./e17dd21e954285ab8e57edc5aaa8d095.js";import{H as F}from"./7178c4095b3167bc462b8cb724642193.js";import"./e8fce94663e5d679d1f5600ec59f654e.js";import{l as ne}from"./4f72198a2c56625f6e2ce33df598b892.js";class ae{captaina_version="1.0.8";this_page="#reload#";hopekey=null;merchants=null;site_url="https://captaina.co";development_url="https://locallhost";custom_url=["captaina.com"].concat(this.site_url).concat(this.development_url);marketplace_idBydomain={};market_urls={"amazon.fr":"A13V1IB3VIYZZH","amazon.sa":"A17E79C6D8DWNP","amazon.nl":"A1805IZSGTT6HS","amazon.sg":"A19VAU5U5O7RUS","amazon.com.mx":"A1AM78C64UM0Y8","amazon.pl":"A1C3SOZRARQ6R3","amazon.co.uk":"A1F83G8C2ARO7P","amazon.de":"A1PA6795UKMFR9","amazon.es":"A1RKKUPIHCS9HS","amazon.co.jp":"A1VC38T7YXB528","amazon.in":"A21TJRUUN4KGV","amazon.ca":"A2EUQ1WTGCTBG2","amazon.se":"A2NODRKZP88ZB9","amazon.com.br":"A2Q3Y263D00KWC","amazon.ae":"A2VIGQ35RCS4UG","amazon.com.tr":"A33AVAJ2PDY3EV","amazon.com.au":"A39IBJ37TRP1C6","amazon.com.be":"AMEN7PMS3EDWL","amazon.it":"APJ6JRA9NG5V4","amazon.eg":"ARBP9OOSHTCHU","amazon.com":"ATVPDKIKX0DER"};market_host_by_details={"amazon.fr":{country_code:"fr",currency:"EUR",currency_symbol:"€",currency_position:"1"},"amazon.sa":{country_code:"sa",currency:"SAR",currency_symbol:"﷼",currency_position:"0"},"amazon.nl":{country_code:"nl",currency:"EUR",currency_symbol:"€",currency_position:"1"},"amazon.sg":{country_code:"sg",currency:"SGD",currency_symbol:"$",currency_position:"0"},"amazon.com.mx":{country_code:"mx",currency:"MXN",currency_symbol:"$",currency_position:"0"},"amazon.pl":{country_code:"pl",currency:"PLN",currency_symbol:"zł",currency_position:"0"},"amazon.co.uk":{country_code:"gb",currency:"GBP",currency_symbol:"£",currency_position:"0"},"amazon.de":{country_code:"de",currency:"EUR",currency_symbol:"€",currency_position:"0"},"amazon.es":{country_code:"es",currency:"EUR",currency_symbol:"€",currency_position:"1"},"amazon.co.jp":{country_code:"jp",currency:"JPY",currency_symbol:"¥",currency_position:"0"},"amazon.in":{country_code:"in",currency:"INR",currency_symbol:"₹",currency_position:"0"},"amazon.ca":{country_code:"ca",currency:"CAD",currency_symbol:"$",currency_position:"0"},"amazon.se":{country_code:"se",currency:"SEK",currency_symbol:"kr",currency_position:"1"},"amazon.com.br":{country_code:"br",currency:"BRL",currency_symbol:"R$",currency_position:"0"},"amazon.ae":{country_code:"ae",currency:"aED",currency_symbol:"د.إ",currency_position:"0"},"amazon.com.tr":{country_code:"tr",currency:"TRY",currency_symbol:"₺",currency_position:"1"},"amazon.com.au":{country_code:"au",currency:"aUD",currency_symbol:"$",currency_position:"0"},"amazon.com.be":{country_code:"be",currency:"EUR",currency_symbol:"€",currency_position:"1"},"amazon.it":{country_code:"it",currency:"EUR",currency_symbol:"€",currency_position:"1"},"amazon.eg":{country_code:"eg",currency:"EGP",currency_symbol:"جنيه",currency_position:"0"},"amazon.com":{country_code:"us",currency:"USD",currency_symbol:"$",currency_position:"0"}};market_pattern_urls=[];pattern_urls=[];debugMode=!1;debugInfo=!1;api_url="https://_crawl.captaina.co";check_notifications_executing=!1;constructor(){Object.keys(this.market_urls).forEach((e=>{this.market_pattern_urls.push("https://*."+e+"/*"),this.marketplace_idBydomain[this.market_urls[e]]="https://www."+e})),Object.keys(this.market_urls).forEach((e=>{this.pattern_urls.push("https://*."+e+"/*"),this.marketplace_idBydomain[this.market_urls[e]]="https://www."+e})),this.custom_url.forEach((e=>{-1===e.indexOf("!*")?this.pattern_urls.push("https://*."+e.replace("https://","")+"/*"):this.pattern_urls.push(e)}))}getKey(){return l.Browser().storage.local.get("hopekey").then((e=>{typeof e.hopekey<"u"&&(this.hopekey=e.hopekey??null)}))}}const C=new ae,f={Local:{},Sync:{},LocalOld:{},SyncOld:{},constructor(){},build:async(e="local",t=0)=>await new Promise((async(a,n)=>await l.Browser().storage[e].get(null).then((async n=>{let o=l.firstUpperCase(e),i=f[o];return Object.keys(n).forEach((e=>{typeof i[e]<"u"&&delete i[e]})),Object.keys(i).length>0&&(await l.Browser().storage[e].set(i),n=Object.assign(i,n)),f[o]=l.JsonParse(n),a(1==t?f[e]:f)})).catch((e=>{console.log(e)})))),async listener(e){return typeof l.Browser().storage.migration_status>"u"&&(l.Browser().storage.migration_status=!1),l.Browser().storage.onChanged.addListener(((t,a)=>{let n=Object.keys(t);if(-1!==n.indexOf("migration_status")){let e=n[n.indexOf("migration_status")];l.Browser().storage.migration_status=t[e].newValue??!1}return Object.keys(t).forEach((e=>{let l=e,n=t[e].oldValue,o=t[e].newValue;if(typeof f[a]>"u"&&(f[a]={}),typeof f[`${a}Old`]>"u"&&(f[`${a}Old`]={}),typeof o<"u"&&null!=o?typeof o[l]<"u"?this[a][l]=f[a][l]=o[l]:this[a][l]=f[a][l]=o:this[a][l]=f[a][l]=null,typeof n<"u"&&null!=n?typeof n[l]<"u"?this[`${a}Old`][l]=f[`${a}Old`][l]=n[l]:this[`${a}Old`][l]=f[`${a}Old`][l]=n:this[`${a}Old`][l]=f[`${a}Old`][l]=null,-1!==l.indexOf("ai_single_")){let e=l.replace("ai_single_","");null==this[a].ai_single&&(this[a].ai_single=f[a].ai_single={}),this[a].ai_single&&typeof this[a].ai_single[e]>"u"&&(this[a].ai_single[e]=f[a].ai_single[e]={}),typeof o[l]<"u"?this[a].ai_single[e]=f[a].ai_single[e]=o[l]:this[a].ai_single[e]=f[a].ai_single[e]=o,console.log(f[a].ai_single[e],o[l],o)}})),e.storage=f,Object.keys(t).forEach((t=>{"settings"==t&&null==f[a][t]&&console.error(t,f[a][t]),f[a][t]!=f[`${a}Old`][t]&&e.changeListener(a,t,f[a][t],f[`${a}Old`][t],l.Browser().storage.migration_status??!1)})),f}))}},O={db_name:"AiTopia",open_db:null,db_version:1,open:async(e=null)=>{if(null!=e&&(O.db_name=e),location&&location.search&&-1!==location.search.indexOf("clear")&&null==O.open_db){await H(O.db_name),await indexedDB.deleteDatabase(O.db_name);let e=new URLSearchParams(location.search);e.delete("clear"),Object.keys(e).length>0?window.location.href=window.location.origin+"?"+e.toString()+location.hash:window.location.href=window.location.origin}return O.open_db=await X(O.db_name,O.db_version,{upgrade(e,t,a,l,n){e.createObjectStore(O.db_name,{keyPath:"key",autoIncrement:!1})},blocked(e,t,a){console.log("BLOCKED")},blocking(e,t,a){console.log("BLOCKING")},terminated(){console.log("TERMINATE")}})},storage:{get:async(e=null)=>{let t={};return"string"==typeof e&&null!=e&&(e=[e]),(null==e||"object"!=typeof e)&&(e=[]),new Promise((async(a,n)=>{let o=await O.open();try{let e=await o.transaction(O.db_name,"readonly").objectStore(O.db_name)}catch(c){return void console.log(c)}let i=await o.transaction(O.db_name,"readonly").objectStore(O.db_name),s=!1,r=[];if(e&&e.length>0){for(let t of e){let e=null;l.notUndefined(f.Local,t)?e={key:t,value:l.notUndefined(f.Local,t)}:(t=l.AesEnCrypt(t),e=await i.get(t),l.notUndefined(e,"key")&&(e.key=l.AesDeCrypt(e.key)??e.key),l.notUndefined(e,"value")&&(e.value=l.JsonParse(l.AesDeCrypt(e.value)??e.value))),r.push(e)}s=!0}s||(r=await i.getAll()),r&&r.forEach((e=>{if(l.notUndefined(e,"value")){let a=l.notUndefined(e,"key"),n=l.notUndefined(e,"value");s||(a=l.AesDeCrypt(a)??null,n=l.JsonParse(l.AesDeCrypt(n)??null)??null),t[a]=f.Local[a]=n}})),a(t)}))},set:async(e={})=>await new Promise((async(t,a)=>{let n=await(await O.open()).transaction(O.db_name,"readwrite").objectStore(O.db_name),o={};if(e&&Object.keys(e).length>0){let t=!1;for(const a of Object.keys(e)){let i=!1;e[a]=l.JsonParse(e[a]);let s={key:l.AesEnCrypt(a),value:l.AesEnCrypt(JSON.stringify(e[a]))??null,updated_date:(new Date).getTime()},r=await n.getKey(l.AesEnCrypt(a)),c=await n.get(l.AesEnCrypt(a));l.notUndefined(c,"key")&&(c.key=l.AesDeCrypt(c.key)??c.key),l.notUndefined(c,"value")&&(c.value=l.JsonParse(l.AesDeCrypt(c.value)??c.value)),typeof r>"u"?(await n.add(s),t=i=!0,o[a]={oldValue:null,newValue:e[a]}):l.notUndefined(c,"value")!=JSON.stringify(e[a])&&(o[a]={oldValue:null,newValue:e[a]},o[a].oldValue=l.JsonParse(l.notUndefined(c,"value")??null)??null,await n.put(s),t=i=!0),i&&(f.Local[a]=e[a])}t&&window.dispatchEvent(new CustomEvent("localStorageOnChange",{detail:o}))}t(!0)})),remove:async e=>new Promise((async(t,a)=>{if(e){let t=await(await O.open()).transaction(O.db_name,"readwrite").objectStore(O.db_name);if(e.length>0&&"object"==typeof e)for(const a of e)if(typeof f.Local[a]<"u"||typeof f.Local[a]<"u"){let e={};e[a]={oldValue:f.Local[a]??f.Local[a]??null,newValue:null},await t.delete(l.AesEnCrypt(a)),typeof f.Local[a]<"u"&&delete f.Local[a],typeof f.Local[a]<"u"&&delete f.Local[a],window.dispatchEvent(new CustomEvent("localStorageOnChange",{detail:e}))}}t(!0)})),clear:async()=>new Promise((async(e,t)=>{await H(O.db_name),window.location.reload(),e(!0)}))},customAddListener:(e,t,a)=>window.addEventListener(e,(e=>"function"==typeof t?t(e.detail,a):{detail:e.detail,namespace:a}))};typeof window<"u"&&(window.umut_storage=O.storage);const le={storage:{local:O.storage,onChanged:{addListener:(e,t)=>O.customAddListener("localStorageOnChange",e,"Local")}},runtime:{id:null}};let x=Q;typeof chrome<"u"&&(x=chrome??x);let Y="aitopia.ai";const N=["chatgptextension.ai",Y];let D=location.hostname.split(".");var Z;D.length>2&&(delete D[0],D=Object.values(D)),D=D.join(".");const J=(null==(Z=null==x?void 0:x.runtime)?void 0:Z.id)??null,E=J?`chrome-extension://${J}`:"";var B=N[N.indexOf(D)]??N[0];const I="chat.";let se=!1,$=B;B&&(B.split(".").length>2&&(delete(B=B.split("."))[0],B=Object.values(B).join(".").toString()),$=B,-1===B.indexOf("chatgptextension")&&-1===B.indexOf("extension://")&&($=I+$));const K="extensions",V="/src/html",d={domain:B,domain_allows:N,runtime_id:J??null,main_dir:V,site:`https://${$}`,site_buy_plan:`https://${$}/subscription`,site_payment:`https://${$}/payment`,site_pricing:`https://${$}/pricing`,login:`https://${$}/auth`,login_prefix:`https://${$}/auth?logout`,profile:`https://${$}/app/profile`,api_mode:K,api_url:`https://${K}.${B}`,download_url:`https://download.${B}`,cdn_url:`https://cdn.${B}`,web_app_prefix:I,web_app:`https://${I}${Y}`,extension_pricing:`${E}${V}/pricing.html`,extension_payment_success:`${E}${V}/payment_success.html`,extension_google_page:"https://chromewebstore.google.com/detail/chatgpt-sidebar-gpt-4-vis/becfinhbfclcgokjlobojlnldbfillpf",extension_id:J,manuel_extension_id:"becfinhbfclcgokjlobojlnldbfillpf",extension_dir:`${E}/`,lang_cache_type:"Local",debugMode:0,version:"5.0.0",app_name:"ChatGPT Sidebar & GPT-4 Vision, GPT-4o, Claude 3.5, Gemini 1.5 | AITOPIA",app_title:"ChatGPT Sidebar & GPT-4 Vision, GPT-4o, Claude 3.5, Gemini 1.5 | AITOPIA",app_description:"ChatGPT Sidebar & GPT-4 Vision by AITOPIA helps you to use ChatGPT-4o & Claude 3.5 in every browser tab easily",build_finish:!1,mode:"production",debug_time:"",web_access_search_limit:5,ai_default_model:"GPT-4o Mini",image_upscaling_id:"image-upscaling",console_data:[],hello_world_test:"function helloWorld(args){if (!args)return false;}function testing(args){if (args)return true;}",disallow_pages:["accounts.google.com"],is_web_app:se,search_pages:{"www.google.com/search":{selector:'body textarea[type="search"],body textarea[aria-label="search"],body textarea[name="q"]',container:"#rhs",empty_selector:"#rcnt",empty_selector_position:"#center_col",empty_element:'<div class="TQc1id rhstc4" jscontroller="cSX9Xe" data-pws="1300" data-spe="true" jsaction="rcuQ6b:npT2md" id="rhs" jsdata="MdeVKb;_;A38Ny0" role="complementary" data-hveid="CAEQAA"></div>'},"www.yandex.com/search":{selector:'body [role="search"] [name="text"]',container:"#search-result-aside",empty_selector:".main__content > div",empty_selector_position:"",empty_element:'<div class="content__right content__right_cols_12" id="search-result-aside" data-log-node="2_apy0w00g" tabindex="-1"><div class="serp-list serp-list_right_yes"></div></div>'},"www.bing.com/search":{selector:'body [role="search"] [type="search"],body [role="search"] .b_searchbox',container:"#b_context",empty_selector:"#b_content > aside:first-child",empty_selector_position:"",empty_element:'<ol id="b_context"></ol>'},"www.duckduckgo.com":{selector:'body #search_form_input, body #search_form > input[type="text"]',container:'#web_content_wrapper [data-testid="sidebar"]',empty_selector:"",empty_selector_position:"",empty_element:'<section data-testid="sidebar" data-area="sidebar"></section>'},"search.yahoo.com/search":{selector:'body [role="search"] input[type="text"]',container:"#results > #cols > #right",empty_selector:"",empty_selector_position:"",empty_element:""},"www.baidu.com/s":{selector:'#form [name="wd"],#form #kw',container:"#container #content_right",empty_selector:"",empty_selector_position:"",empty_element:""},"www.ask.com/web":{selector:'[name="searchBoxContainer"] [name="q"]',container:"main .l-right-container",empty_selector:"",empty_selector_position:"",empty_element:""},"search.aol.com":{selector:'[role="search"] [name="q"]',container:"#results > #cols > #right",empty_selector:"",empty_selector_position:"",empty_element:""}},ai_reply:{"mail.google.com":{reply_button:".ams.bkH",button:".amn",container:'[role="listitem"]:last-child',alternative_container:'[role="listitem"]:last-child',edit_container:'[role="listitem"] .editable',reply_insert_container:".Am.Al.editable.LW-avf",dot_position:{bottom:"25%",left:"85%"},detail_elements:[{name:"history",selector:".adL.gmail_quote,.adL .gmail_quote",mode:"simple",type:"textContent"},{name:"sender_email",selector:".gD[email]",mode:"attribute",type:"email"},{name:"sender_name",selector:".gD[name]",mode:"attribute",type:"name"},{name:"receiver_email",selector:".g2[email]",mode:"attribute",type:"email"},{name:"receiver_name",selector:".g2[name]",mode:"attribute",type:"name"},{name:"email_content",selector:".a3s > *",mode:"simple",type:"innerText"}]},"outlook.live.com":{reply_button:".th6py button:first-child",button:".Jj1JU,.th6py",container:'[role="document"][aria-expanded="true"]',alternative_container:'[role="document"][aria-expanded]',edit_container:'[id*="editorParent_"] [role="textbox"][contenteditable="true"]',reply_insert_container:"[id*='editorParent_'] [contenteditable=\"true\"] > *:first-child",dot_position:{bottom:"50%",left:"80%"},detail_elements:[{name:"history",selector:".adL.gmail_quote,.adL .gmail_quote",mode:"simple",type:"textContent"},{name:"sender_email",selector:".OZZZK",mode:"simple",type:"textContent"},{name:"sender_name",selector:".OZZZK",mode:"simple",type:"textContent"},{name:"receiver_email",selector:"._EType_RECIPIENT_ENTITY [aria-label]",mode:"attribute",type:"aria-label"},{name:"receiver_name",selector:"._EType_RECIPIENT_ENTITY [aria-label]",mode:"attribute",type:"aria-label"},{name:"email_content",selector:'[role="document"][aria-expanded="true"] [id*="UniqueMessageBody_"] div',mode:"simple",type:"innerText"}]},"mail.yandex.com":{reply_button:".qa-QuickReplyPlaceholder",button:".ns-view-toolbar-buttons .ns-view-container-desc",container:".mail-Layout-Content",alternative_container:".qa-MessageViewer article:last-child",edit_container:'[role="presentation"] [role="textbox"]',reply_insert_container:'[role="presentation"] [role="textbox"] div',dot_position:{bottom:"25%",left:"75%"},detail_elements:[{name:"history",selector:".qa-MessageViewer article",mode:"simple",type:"textContent"},{name:"sender_email",selector:".qa-MessageViewer-SenderEmail",mode:"attribute",type:"title"},{name:"sender_name",selector:".qa-MessageViewer-SenderName",mode:"attribute",type:"title"},{name:"receiver_email",selector:".qa-MessageViewer-RecipientsTitle",mode:"simple",type:"textContent"},{name:"receiver_name",selector:".qa-MessageViewer-RecipientsTitle",mode:"simple",type:"textContent"},{name:"email_content",selector:".qa-MessageViewer article",mode:"simple",type:"innerText"}]}},ai_reply_data:{},click_open_url:{"aitopia-pricing":"extension_pricing","aitopia-login":"login","aitopia-login-prefix":"login_prefix","aitopia-subscription":"site_buy_plan","aitopia-profile":"profile","aitopia-g-extension":"extension_google_page","aitopia-options":"./src/html/options.html","aitopia-options-search":"./src/html/options.html?mode=search"},aspect_rations:[{value:"21 : 9",tooltipText:"1536 x 640",width:"1536",height:"640"},{value:"16 : 9",tooltipText:"1344 x 768",width:"1344",height:"768"},{value:"3 : 2",tooltipText:"1216 x 832",width:"1216",height:"832"},{value:"5 : 4",tooltipText:"1152 x 896",width:"1152",height:"896"},{value:"1 : 1",tooltipText:"1024 x 1024",width:"1024",height:"1024"},{value:"4 : 5",tooltipText:"896 x 1152",width:"896",height:"1152"},{value:"2 : 3",tooltipText:"832 x 1216",width:"832",height:"1216"},{value:"9 : 16",tooltipText:"768 x 1344",width:"768",height:"1344"},{value:"9 : 21",tooltipText:"640 x 1536",width:"640",height:"1536"}],styles:[{name:"None",style:"none",icon:`${E}/assets/images/image_chat/default.png`},{name:"Anime",style:"anime",icon:`${E}/assets/images/image_chat/anime.png`},{name:"Photographic",style:"photographic",icon:`${E}/assets/images/image_chat/photographic.png`},{name:"Digital Art",style:"digital-art",icon:`${E}/assets/images/image_chat/digital_art.png`},{name:"Comic Book",style:"comic-book",icon:`${E}/assets/images/image_chat/comic_book.png`},{name:"Fantasy Art",style:"fantasy-art",icon:`${E}/assets/images/image_chat/fantasy_art.png`},{name:"Line Art",style:"line-art",icon:`${E}/assets/images/image_chat/line_art.png`},{name:"Analog Film",style:"analog-film",icon:`${E}/assets/images/image_chat/analog_film.png`},{name:"Neon Punk",style:"neon-punk",icon:`${E}/assets/images/image_chat/neon_punk.png`},{name:"Isometric",style:"ısometric",icon:`${E}/assets/images/image_chat/isometric.png`},{name:"Low Poly",style:"low-poly",icon:`${E}/assets/images/image_chat/low_poly.png`},{name:"Origami",style:"origami",icon:`${E}/assets/images/image_chat/origami.png`},{name:"Cinematic",style:"cinematic",icon:`${E}/assets/images/image_chat/cinematic.png`},{name:"3D Model",style:"3d-model",icon:`${E}/assets/images/image_chat/three_d_model.png`},{name:"Pixel Art",style:"pixel-art",icon:`${E}/assets/images/image_chat/pixel_art.png`}],tools:[{id:1,name:"Remove Background",description:"Extract the main subject from a image with incredible accuracy.",video:`${E}/assets/videos/remove-background-demo.mp4`,actionCode:"remove-background"},{id:2,name:"Remove Text",description:"Remove text from any image.",video:`${E}/assets/videos/remove-text-demo.mp4`,actionCode:"remove-text"},{id:3,name:"Upscale",description:"Upscale your image by 2× or 4× with in seconds.",video:`${E}/assets/videos/Enhance.webm`,actionCode:"image-upscaling"},{id:4,name:"Replace Background",description:"Teleport anything, any where with AI.",video:`${E}/assets/videos/ReplaceBackground.webm`,actionCode:"replace-background"}],editTools:[{credit:1,id:"image-upscaling",image:!0,mask:!1,name:"Image Upscaling",prompt:!1,size:!0,explanation:"Select image magnification:",sectionWidth:90},{credit:1,id:"reimagine",image:!0,mask:!1,name:"Variation",prompt:!1,size:!1,explanation:null,sectionWidth:null},{credit:4,id:"remove-background",image:!0,mask:!1,name:"Remove Background",prompt:!1,size:!1,explanation:"Remove background from this image",sectionWidth:65},{credit:4,id:"remove-text",image:!0,mask:!1,name:"Remove Text",prompt:!1,size:!1,explanation:"Remove all text from the image",sectionWidth:60},{credit:6,id:"replace-background",image:!0,mask:!1,name:"Replace Background",prompt:!0,size:!1,explanation:null,sectionWidth:90}],pinnedContextPrompts:{reading:[42,43],writing:[45,56]},contextBlacklist:{"www.google.com":{selectors:["textarea[role='combobox']"]}},ExtensionBrowser:x??chrome??{},Browser:J?x??chrome??{}:le,api_call_try:0,api_call_max_try:6,reply_prompts:{getEmailIntent:64,getEmailKeyPoints:65,getRelatedSuggestions:66,askAiReply:63},default_prompt_settings:{format:{model:"model_settings.format.items",label_before:"model_settings.format.html",label:"model_settings.format.title",model_element_before:"html",model_element:"title",model_prefix:"prefix",model_default:"prompt_settings.format",default:"essay",type:"radio"},tone:{model:"model_settings.tone.items",label_before:"model_settings.tone.html",label:"model_settings.tone.title",model_element_before:"html",model_element:"title",model_prefix:"prefix",model_default:"prompt_settings.tone",default:"formal",type:"radio"},length:{model:"model_settings.length.items",label_before:"model_settings.length.html",label:"model_settings.length.title",model_element_before:"html",model_element:"title",model_prefix:"prefix",model_default:"prompt_settings.length",default:"short",type:"radio"},lang:{model:"storage.Local.languages",no_translate:!0,model_element:"title",model_prefix:"name",model_default:"settings.language_detail.name",type:"select",label:"Language"}}},y={switchbar:"chat",color_mode:"auto",ai_mode:"local",ai_key:null,language:re(),language_name:null,language_detail:{},send_cmd:"enter",sidebar_cmd:"ctrl+y",color_mode_cmd:"ctrl+shift+l",fullscreen_cmd:"ctrl+shift+f",sidebar_show_icon:!0,sidebar_position:"right",sidebar_space:"overlay",search:!0,search_ask_mode:"manuel",ai_model:d.ai_default_model,web_access:!1,context_reading:!0,context_reading_show_cmd:"ctrl",context_menu_shortcut_cmd:"ctrl+j",context_writing:!0,context_writing_input:!0,email_assistant:!0};function re(){let e=navigator.language||(navigator.userLanguage??"en");return-1!=e.indexOf("-")&&(e=e.split("-")[0]),-1!=e.indexOf("_")&&(e=e.split("_")[0]),e}class oe{marked;count;constructor(){this.marked=new te(ie({langPrefix:"hljs language-",highlight(e,t,a){const l=F.getLanguage(t)?t:"plaintext";return F.highlight(e,{language:l}).value}})),this.marked.Renderer.prototype.paragraph=e=>"string"==typeof e?e+"\n":e.text+"\n",this.marked.Renderer.prototype.link=({href:e,title:t,text:a})=>{let l="";typeof t<"u"&&(l='title="'+t+'" ');let n="";typeof e<"u"&&(n='href="'+e+'" ');let o="";return-1!==e.indexOf("://")&&(o='target="_blank" '),"<a "+o+n+" "+l+">"+a+"</a>"}}pretty(e){if(null===e||typeof e>"u"||"object"==typeof e||-1!==e.indexOf("hljs language"))return e;let t;return this.marked.parse(e.replace(/^[\u200B\u200C\u200D\u200E\u200F\uFEFF]/,""),t).toString()}}const fe=new oe,W={QUESTION:{START:"<a href='javascript:;' class=\"ait-action-question\">",END:"</a>"},SUGGESTION:{START:"<a href='javascript:;' class=\"ait-action-suggestion\">",END:"<span>→</span></a>"}};console.time();const G={chats:{},ai_all_response:{},ai_response:[],instance:null,aborting:{},long_prefix:"<#Finished#>",count:0,extra_key:null,expires:{},ai_wait:!1,prompt_prefix:"##",last_stream:"",async chat(e="",t=null,a="ai_chat",n="__all",o=!1,i=!1,s=null,r=!1,c={}){if(this.ai_wait)return;typeof this.aborting[n]<"u"&&(this.aborting[n]=null);let u=await l.Browser().storage.local.get(["settings","credit_detail","expires","ai_image_url","ai_chat_ids",a]);this.key_detail=await l.Browser().storage.local.get(["uuid_hopekey","uuid_search"]),this.settings=l.notUndefined(u,"settings"),null==t&&(t=d.ai_default_model);let g=this.settings.ai_image_model==t?"image":"text";null===t&&(t=this.settings.ai_model),this.waiting(!0),this.credit_detail=l.notUndefined(u,"credit_detail"),typeof this.ai_all_response[n]>"u"&&(this.ai_all_response[n]={}),typeof this.ai_all_response[n][a]>"u"&&(this.ai_all_response[n][a]=[]);let p=l.notUndefined(u,`${a}`);null!=typeof u.expires&&(this.expires=u.expires);let _={};"string"==typeof p?(_=JSON.parse(p),Object.keys(_).length>0&&Object.keys(_).forEach((e=>{typeof this.ai_all_response[e]>"u"&&(this.ai_all_response[e]={}),this.ai_all_response[e][a]=Object.values(_[e])}))):(_=p,null!=_&&("ai_chat"==a?this.ai_all_response[n][a]=Object.values(_):typeof _[n]<"u"&&(this.ai_all_response[n][a]=Object.values(_[n])))),"ai_single"==a&&1==o&&0==r&&typeof this.ai_all_response[n]<"u"&&typeof this.ai_all_response[n][a]<"u"&&(this.ai_all_response[n][a]=[],await this.setDataStorage(a,n),Object.keys(this.ai_all_response[n][a]).length),this.uuid_search=l.notUndefined(this.key_detail,"uuid_search"),this.hopekey=l.notUndefined(this.key_detail,"uuid_hopekey"),document.querySelector("#aitopia-container");let m=`${d.api_url}/ai/send`;if(null!=this.credit_detail){let e=t;if(this.settings.web_access&&(e="GPT-4o"),typeof this.credit_detail[e]<"u"&&this.credit_detail[e].balance<this.credit_detail[e].cost&&-999!=this.credit_detail[e].credit&&"api"!==this.settings.ai_mode)return this.ai_all_response[n][a].forEach(((e,t)=>{"limit"==e.role&&delete this.ai_all_response[n][a][t]})),this.ai_all_response[n][a]=Object.values(this.ai_all_response[n][a]),this.ai_all_response[n][a].push({item:"Usage Limit please upgrade plan.",role:"limit",model:t}),await this.setDataStorage(a,n),void(await this.waiting(!1))}let f=this.ai_all_response[n][a],h=0,y=!1;Object.keys(this.ai_all_response[n][a]).length>0&&!l.notUndefined(c,"search")&&this.ai_all_response[n][a].forEach(((e,t)=>{h++,f!=h&&1==this.ai_all_response[n][a][t].loading&&(this.ai_all_response[n][a][t].loading=!1,y=!0),"limit"==e.role&&(delete this.ai_all_response[n][a][t],this.ai_all_response[n][a]=Object.values(this.ai_all_response[n][a]),y=!0)})),y&&await this.setDataStorage(a,n);let b="";this.count++;let w="user";"image"==g&&(w="image"),(null==c||"object"!=typeof c)&&(c={}),(String(e).trim().length>0||"image"==w)&&0==r&&(c.prompt_mode=i,this.ai_all_response[n][a].push({item:e,role:w,model:t,title:s,loading:"image"==w,extra_data:c})),"image"!=g&&null!=l.notUndefined(u,"ai_image_url")&&""!==l.notUndefined(u,"ai_image_url")&&typeof c.search_mode>"u"&&(t="GPT-4o Vision",this.settings.web_access=!1,c.ai_image_url=l.notUndefined(u,"ai_image_url"),await l.Browser().storage.local.set({ai_image_url:null}),await l.Browser().storage.local.remove(["ai_image_url"]));let x=l.ChatId(a,n),v={history:this.ai_all_response[n][a],text:e,model:t,stream:"image"!=g,uuid_search:this.uuid_search,mode:a,prompt_mode:i,extra_key:n,extra_data:c,chat_id:x,language_detail:this.settings.language_detail,is_continue:r};this.settings.ai_key&&"api"==this.settings.ai_mode&&(v.token=this.settings.ai_key),this.settings.language&&(v.lang_code=this.settings.language);let k=this.ai_all_response[n][a].length;("image"==g||l.notUndefined(c,"search"))&&(k-=1),k<0&&(k=0);let S="";1==r&&this.ai_all_response[n][a].forEach(((e,t)=>{typeof e.finish_reason<"u"&&"length"==e.finish_reason&&(e.finish_reason="",k=t,b=S=e.item)})),this.ai_all_response[n][a].forEach(((e,t)=>{typeof e.finish_reason<"u"&&"length"==e.finish_reason&&(e.finish_reason="stop")})),"image"!=g&&(this.ai_all_response[n][a][k]={item:S,role:"system",model:t,loading:!0,title:s,extra_data:c}),await this.setDataStorage(a,n),this.aborting[n]=new AbortController;let O=document.querySelectorAll("#ait-stop-chat-"+a),E=document.querySelectorAll("#ait-stop-chat-"+a+" button");null!=E&&null!=O&&(O.forEach((e=>{e.classList.remove("ait-hide"),e.classList.add("ait-show")})),this.aborting[n].signal.addEventListener("abort",(()=>{"ai_single"==a?Object.values(this.ai_all_response[n][a]).length>0&&this.ai_all_response[n][a].forEach(((e,t)=>{this.ai_all_response[n][a][t].loading=!1,this.ai_all_response[n][a][t].stop=!0})):(this.ai_all_response[n][a][k].loading=!1,this.ai_all_response[n][a][k].stop=!0),this.setDataStorage(a,n),this.waiting(!1)})),Object.keys(E).length>0&&E.forEach((e=>{e.onclick=e=>{this.aborting[n].abort(),this.waiting(!1),l.sendMessage("uuid",{data:1}),O.forEach((e=>{e.classList.add("ait-hide"),e.classList.remove("ait-show")}))}})));let L=null;return await this.setDataStorage(a,n),-1!==["image"].indexOf(g)?await this.imageApi(a,t,n,v,k,O,L,m,b).finally((async()=>await this.waiting(!1))):1==l.notUndefined(this.settings,"web_access")&&-1===["image"].indexOf(t)&&0==r&&"__all"==n&&!l.notUndefined(c,"search")&&e.length<=300&&0==i?(l.Browser().web_access_mode=a,l.Browser().web_access_extra_key=n,l.sendMessage("GoogleSearchCall",e,"GoogleSearchCallback","tabs")):await this.aiApi(a,t,n,v,k,O,L,m,b,this).finally((async e=>{await this.waiting(!1)}))},async AiSync(e,t,a=d.ai_default_model,n){let o={history:e,text:t,model:a,stream:!1,uuid_search:this.uuid_search,mode:"ai_chat",prompt_mode:!1,extra_key:"__all",extra_data:n??{search_fixer:!0},chat_id:null,language_detail:this.settings.language_detail};return l.apiCall(`${d.api_url}/ai/send`,o,"POST",-1).then((e=>l.notUndefined(e,"choices.0.message.content")??null))},async imageApi(e,t,a,n,o,i,s,r,c){let d=n.extra_data.image_count??1;if(this.credit_detail[t]&&d*(this.credit_detail[t].cost??1)>this.credit_detail[t].balance&&-999!=this.credit_detail[t].credit&&"-999"!=this.credit_detail[t].credit)return this.ai_all_response[a][e].forEach(((t,l)=>{"limit"==t.role&&delete this.ai_all_response[a][e][l]})),this.ai_all_response[a][e][o].loading=!1,this.ai_all_response[a][e]=Object.values(this.ai_all_response[a][e]),this.ai_all_response[a][e].push({item:"Usage Limit please upgrade plan.",role:"limit",model:t}),void(await this.setDataStorage(e,a));let u={role:"image",item:n.text,loading:!0,images:[]};this.ai_all_response[a][e][o]={...this.ai_all_response[a][e][o],...u},await this.setDataStorage(e,a);let g="/ai/image";return null!=n.extra_data.action&&(g="/ai/image_editing"),l.apiCall(g,n,"POST",-1).then((async r=>{let c=r;return typeof c.images>"u"&&(c.images=[]),typeof c.seed>"u"&&(c.seed=null),u.images=c.images||[],u.loading=!1,u.seed=c.seed||null,this.ai_all_response[a][e][o]={...this.ai_all_response[a][e][o],...u},typeof c<"u"&&typeof c.message<"u"&&this.ai_all_response[a][e].push({item:c.message??null,role:c.type??"error",model:t,finish_reason:s,loading:!1}),await this.setDataStorage(e,a),l.sendMessage("uuid",{data:1}),null!=i&&i.forEach((e=>{e.classList.add("ait-hide"),e.classList.remove("ait-show")})),null!=n.extra_data.action&&l.Browser().storage.local.get("image_settings").then((e=>{e.image_settings.image=null,e.image_settings.action=null,l.Browser().storage.local.set(e)})),this.ai_all_response[a][e][o]})).catch((e=>{console.log(e)}))},async aiApi(e,t,a,n,o,i,s,r,c,d=this){let u=0;return fetch(r,{headers:{accept:"text/plain",hopekey:this.hopekey??null},body:JSON.stringify(n),method:"POST",signal:this.aborting[a].signal}).then((async t=>{const l=t.body.getReader();let n=async()=>l.read().then((async({value:t,done:l})=>{if(await d.streamFormatter(t,l,a,e,o,u,d),u++,!l)return await n()})).catch((t=>{if(d.waiting(!1),t instanceof DOMException&&"AbortError"==t.name)return null!=document.querySelector(".ai_loading")&&document.querySelector(".ai_loading").classList.remove("ai_loading"),void(d.ai_all_response[a][e][o]._abort=!0);"network error"==t.message?(d.ai_all_response[a][e][o].loading=!1,d.ai_all_response[a][e][o]._error=JSON.stringify(t),console.log(t.message)):(d.ai_all_response[a][e][o].loading=!1,console.log(t.message,t.toString(),t),console.log(d.ai_all_response[a][e]),console.log(c??null),d.ai_all_response[a][e][o]._error=JSON.stringify(t)),d.setDataStorage(e,a)}));return await n()})).then((e=>{})).catch((t=>{this.waiting(!1),this.ai_all_response[a][e][o].loading=!1,this.ai_all_response[a][e][o].loading=!1;let n='<span class="ait-text-red-600">'+l.__("(Internet connection lost. Please try again)")+"</span>";null!=i&&i.forEach((e=>{e.classList.add("ait-hide"),e.classList.remove("ait-show")})),c.length>0&&(n=c+"\n\n"+n),this.ai_all_response[a][e][o].item=n,d.ai_all_response[a][e][o]._error=JSON.stringify(t),this.setDataStorage(e,a),console.log(t)}))},async setData(e,t,a=!0,n=this){let o={};return o[e]={},new Promise((i=>{null===n.instance&&i(!1);let s=n.instance[e];"string"==typeof s&&null!=s&&(s=JSON.parse(s)),"__all"!=t&&null!=t&&"ai_chat"!=e&&a?(null!=s&&Object.keys(s).length>0&&Object.keys(s).forEach((t=>{o[e][t]=s[t]})),typeof n.ai_all_response[t]<"u"&&typeof n.ai_all_response[t][e]<"u"&&(o[e][t]=n.ai_all_response[t][e])):o[e]=n.ai_all_response[t][e],n.instance.storage&&n.instance.storage.Local&&(n.instance.storage.Local[e]=o[e]),n.instance[e]=o[e],n.instance.$root&&(n.instance.$root[e]=o[e]),n.instance.$data&&(n.instance.$data[e]=o[e]),l.scrollToBottom(),i(o)}))},async setDataStorage(e,t,a=!0){let n={};return n[e]={},await l.Browser().storage.local.get(e).then((async o=>{let i=o[e];return"string"==typeof i&&null!=i&&(i=JSON.parse(i)),"__all"!=t&&null!=t&&"ai_chat"!=e&&a?(null!=i&&Object.keys(i).length>0&&Object.keys(i).forEach((t=>{n[e][t]=i[t]})),typeof this.ai_all_response[t]<"u"&&typeof this.ai_all_response[t][e]<"u"&&(n[e][t]=this.ai_all_response[t][e]),Object.keys(this.ai_all_response).forEach((t=>{typeof this.ai_all_response[t][e]<"u"&&(n[e][t]=this.ai_all_response[t][e])}))):n[e]=this.ai_all_response[t][e],l.scrollToBottom(),await l.Browser().storage.local.set(n).then((async()=>await this.setData(e,t)))}))},async streamFormatter(e,t,a,n,o,i=0,s=this){this.last_stream=this.last_stream+(new TextDecoder).decode(e,{stream:!0}).toString();let r=this.last_stream,c=r.toString();if(r=r.replace(/"data":\{/gi,'"data": {').replace(/data:\{/gi,"data: {").replace(/"error":\{/gi,'"error": {').replace(/error:\{/gi,"error: {").replace(/\r/,"\n"),typeof r.match>"u")return void(this.ai_all_response[a][n][o].loading=!1);const d=r.match(/(\w+): \{(.*)\}/gi);if(r.match(/error: \{(.*)\}/gi),t)return this.ai_all_response[a][n][o].loading=!1,await this.setDataStorage(n,a),await this.waiting(!1),l.sendMessage("uuid",{data:1}),void l.scrollToBottom();if(null!=d||t||0!=i){if(null==d&&t&&i<2&&(null===this.ai_all_response[a][n][o].item||""===this.ai_all_response[a][n][o].item)){this.ai_all_response[a][n][o].loading=!1,this.ai_all_response[a][n][o].loading=!1;let e='<span class="ait-text-red-600">'+l.__("(Internet connection lost. Please try again)")+"</span>";return this.ai_all_response[a][n][o].item=e,this.ai_all_response[a][n][o].role="error",await this.setDataStorage(n,a),await this.waiting(!1),this.ai_all_response[a][n][o].item}}else{let e=l.JsonParse(r);if(l.notUndefined(e,"error"))return this.ai_all_response[a][n][o].loading=!1,this.ai_all_response[a][n][o].item=l.notUndefined(e,"error.message"),this.ai_all_response[a][n][o].role="error",await this.setDataStorage(n,a),await this.waiting(!1),this.ai_all_response[a][n][o].item}if("object"!=typeof d||null===d||!d){this.ai_all_response[a][n][o].loading=!1;let e=l.JsonParse(r);if(null!==e){let t=l.notUndefined(e,"choices.0.delta")??l.notUndefined(e,"choices.0"),i=l.notUndefined(t,"content")??l.notUndefined(t,"message"),s=l.notUndefined(t,"role");s&&i&&t&&(this.ai_all_response[a][n][o].item=i.toString(),this.ai_all_response[a][n][o].role=s)}return await this.setDataStorage(n,a),await this.waiting(!1),this.ai_all_response[a][n][o].item}let u=c.split(/(\w+): (.*)$/gm);u&&u.forEach((async e=>{if(e&&typeof e<"u"){let t=e,r=l.JsonParse(e.trim());if("object"==typeof r)await s.streamToResponseData(r,a,n,o,i);else if("{"==t.substring(0,1)&&"}"==t.substring(t.length-1,t.length)){let e=l.JsonParse(t.trim());await s.streamToResponseData(e,a,n,o,i)}}}));let g=this.ai_all_response[a][n][o].item;return typeof g<"u"&&""!=g&&null!=g&&(this.last_stream=""),g},async streamToResponseData(e,t,a,n,o=0,i=this){if(l.notUndefined(e,"error.message"))return i.ai_all_response[t][a][n].loading=!1,i.ai_all_response[t][a][n].item=l.notUndefined(e,"error.message"),i.ai_all_response[t][a][n].role="error",await i.setDataStorage(a,t),await i.waiting(!1),i.ai_all_response[t][a][n].item;let s=l.notUndefined(e,"choices.0.delta"),r=l.notUndefined(s,"content")??"",c=l.notUndefined(e,"choices.0.finish_reason")??null;if(typeof i.ai_all_response[t]>"u"&&(i.ai_all_response[t]={}),typeof i.ai_all_response[t][a]>"u"&&(i.ai_all_response[t][a]=[]),typeof i.ai_all_response[t][a][n]>"u"&&(i.ai_all_response[t][a][n]={item:"",role:"",loading:!0}),i.ai_all_response[t][a][n].item+=r.toString(),d.debugMode&&console.log(l.notUndefined(e,"finish_text")),l.notUndefined(e,"finish_text"))return i.ai_all_response[t][a][n].item=l.notUndefined(e,"finish_text"),i.ai_all_response[t][a][n].role="error"===l.notUndefined(e,"type")?"error":"system",i.ai_all_response[t][a][n].loading=!1,await i.setDataStorage(a,t),await i.waiting(!1),i.ai_all_response[t][a][n].item;l.notUndefined(i.ai_all_response[t][a],`${n}.model`);let u=parseInt(l.notUndefined(e,"mod")??10);return isNaN(u)&&(u=10),c&&null!==c&&(i.ai_all_response[t][a][n].finish_reason=c),o%u==0||1==o||u<=1?await i.setDataStorage(a,t):await i.setData(a,t),r},linkify:e=>null==e?"":fe.pretty(e)??e,waiting:async(e=!0)=>(0==e?document.querySelectorAll('[id*="ait-stop-chat-"]').forEach((e=>{e.classList.add("ait-hide"),e.classList.remove("ait-show")})):document.querySelectorAll('[id*="ait-stop-chat-"]').forEach((e=>{e.classList.add("ait-show"),e.classList.remove("ait-hide")})),await l.Browser().storage.local.set({ai_wait:e}).then((()=>l.scrollToBottom()))),prefixify(e){if(null==e)return"";let t=this.prompt_prefix.toString();return"function"!=typeof(e=e.toString()).replace||Object.keys(W).forEach((a=>{let l=W[a];Object.keys(l).forEach((n=>{let o=l[n],i=new RegExp(`\n${t}${a}_${n}${t}\n`.toString(),"gi"),s=new RegExp(`\n${t}${a}_${n}${t}`.toString(),"gi"),r=new RegExp(`${t}${a}_${n}${t}\n`.toString(),"gi"),c=new RegExp(`${t}${a} ${n}${t}\n`.toString(),"gi"),d=new RegExp(`${t}${a}_${n}${t}`.toString(),"gi");e=e.replace(i,o).replace(s,o).replace(r,o).replace(c,o).replace(d,o)}))})),e},async testChat(e,t,a,l,n,o=10){for(let i=0;i<o;i++){typeof this.ai_all_response[t]>"u"&&(this.ai_all_response[t]={}),typeof this.ai_all_response[t][a]>"u"&&(this.ai_all_response[t][a]=[]),this.ai_all_response[t][a]=Object.values(this.ai_all_response[t][a]);let e="";this.ai_all_response[t][a][n]&&typeof this.ai_all_response[t][a][n].item<"u"&&(e=this.ai_all_response[t][a][n].item),this.ai_all_response[t][a][n]={item:e+"TEST"+(new Date).toDateString()+"____>"+i,role:"system",model:l},await this.setData(a,t)}},streamRegExBuilder:(e,t,a=!1)=>{let l=null;try{l=t.match(e)[0]??null,null!==l&&a&&(l=l.replace(/(data|error|event|ping|finish): /,""))}catch{l=null}return l},bulkPrettier:(e,t=!1)=>(console.log(e),e&&"object"==typeof e&&Object.keys(e).forEach((a=>{typeof e[a].item<"u"&&typeof e[a].is_prettier>"u"&&null!==e[a].item&&(e[a].item=G.prefixify(G.linkify(e[a].item)),t&&(e[a].item=e[a].item.replace(/\n/g,"<br>")))})),e)};typeof window<"u"&&typeof document<"u"&&(window.getCookie=e=>{var t=document.cookie.match(new RegExp("(^| )"+e+"=([^;]+)"));if(t)return t[2]},window.setCookie=(e,t,a,l=null)=>{var n="";if(a){var o=new Date;o.setTime(o.getTime()+24*a*60*60*1e3),n="; expires="+o.toUTCString()}null==l&&(l=window.location.host,window.location.host.split(".").length>2&&(l="."+(l=window.location.host.split(".")).slice(1).join("."))),document.cookie=e+"="+(t||"")+n+"; path=/; domain="+l},window.eraseCookie=(e,t=null)=>{null==t&&(t=window.location.host,window.location.host.split(".").length>2&&(t="."+(t=window.location.host.split(".")).slice(1).join("."))),document.cookie=e+"=null; expires=Thu, 01 Jan 1970 00:00:01 GMT; path=/; domain="+t});class ue{start_key=0;check_key_time=null;notify=ee.useToast({duration:5e3,position:"top"});resizeBorder=(e,t=320,a=null)=>{if(null==e)return;let l;e.classList,e.id;let n=document.createElement("div");n.classList.add("ai-el-resize"),e.append(n);const o=a=>{const n=l-a.x;l=a.x;let o=parseInt(getComputedStyle(e,"").width)+n;o>=t&&(e.style.width=`${o}px`)};return n.addEventListener("mousedown",(function(e){e.offsetX<t&&(l=e.x,document.addEventListener("mousemove",o,!1),a&&a(l))}),!1),document.addEventListener("mouseup",(function(e){document.removeEventListener("mousemove",o,!1)}),!1),l};fetchWithTimeout=(e,t={},a=6e4)=>{let l=null,n={...t};if(a>0){let e=new AbortController;l=setTimeout((()=>{e.abort(),clearTimeout(l)}),a),n.signal=e.signal}return fetch(e,n).then((function(e){return null!=l&&clearTimeout(l),e})).finally((()=>{null!=l&&clearTimeout(l)}))};NodeSearch=(e,t)=>[...e].filter((e=>-1!==e.outerHTML.indexOf(t)));setKey=(e=!0)=>1==this.start_key||Math.floor((Date.now()-this.check_key_time)/1e3)<=1&&null!=this.check_key_time?l.Browser().storage.local.get("hopekey"):(d.debugMode&&console.log(this.check_key_time,Math.floor((Date.now()-this.check_key_time)/1e3)<=1||null==this.check_key_time),this.check_key_time=Date.now(),l.Browser().storage.local.get("hopekey").then((e=>typeof e.hopekey<"u"?(C.hopekey=e.hopekey??null,null==C.hopekey||"false"==C.hopekey?(fetch(C.api_url+"auth/logout",{method:"POST",headers:{"Content-Type":"application/json"}}).then((e=>e.text())),l.Browser().storage.local.remove(["hopekey","merchants","credits"]).then()):l.Browser().storage.local.get("merchants").then((e=>{typeof e.merchants<"u"&&(C.merchants=e.merchants)}))):(this.start_key=1,fetch(C.site_url+"/extensions/app/get_key",{method:"POST",headers:{"Content-Type":"application/json"}}).then((e=>e.text())).then((e=>{if(typeof(e=JSON.parse(e)).data<"u"&&typeof e.data.key<"u"){if(C.debugMode&&console.log({hopekey:e.data.key}),l.Browser().storage.local.set({hopekey:e.data.key}).then(),typeof e.data.licences<"u"&&typeof e.data.licences.markets<"u"){let t={merchants:e.data.licences.markets};l.Browser().storage.local.set(t).then(),C.merchants=t.merchants}if(typeof e.data.token_usage<"u"&&typeof e.data.token_usage<"u"){let t={credits:e.data.token_usage};l.Browser().storage.local.set(t).then()}l.Browser().storage.local.set({is_login:!0}).then(),C.hopekey=e.data.key,C.debugMode&&console.log(C.merchants,C.hopekey)}this.start_key=0,C.debugMode&&console.log(e)})).catch((e=>{this.start_key=0,d.debugMode&&console.log(e)}))))));logout=()=>this.apiCall("/auth/logout",{},"POST").finally((()=>l.uuid(1).finally((()=>{this.notify&&this.notify.success(this.__("Successfully logged out."))}))));storageLocalClearAll=(e=!1)=>{let t=["token_usage","credits","licences","uuid_hopekey","uuid_search","expires","credit_usage","credit_detail","credit_detail_visual"];return 1==e&&(t=null),chrome.storage.local.get(t).then((e=>(d.debugMode&&console.log(e),l.Browser().storage.local.remove(Object.keys(e)))))};sendMessageWindowListener=(e,t,a)=>l.sendMessageListener(e,{},t);sendMessageListener=async(e,t,a,n=!1)=>{let o=[],i=null;if(typeof e.data<"u"&&(o=e.data),i=l.messageExecute(null,e.fn,o,!1,this),i&&"function"==typeof i.then&&n){let e=await i;e&&(i=e)}return null==a?{received:!0,return_data:i}:l.messageSendResponse(i,o,t,a)};sendMessage=(e,t={},a=null,n="scripting",o="runtime",i=null)=>{let s=null!=d.runtime_id?chrome??this.Browser()??{}:this.Browser(),r={fn:e,data:{data:t,callback:a,type:n}},c=e=>({received:!0,return_data:e});if(null===d.runtime_id&&!l.notUndefined(s[o],"sendMessage"))return l.onMessageExecutePre(r,{},c);if(!(typeof s[o]>"u"||typeof s[o].sendMessage>"u"))try{return s[o].sendMessage(i??s.runtime.id??null,r,c)}catch(u){return d.debugMode&&console.log(u),l.onMessageExecutePre(r,{},c)}};onMessageListener=()=>l.notUndefined(l.Browser().runtime,"onMessage")?l.Browser().runtime.onMessage.addListener(((e,t,a)=>l.onMessageExecutePre(e,t,a))):new Promise((e=>e(!1)));onMessageExecutePre=(e,t,a)=>{let n=[],o=null;return l.notUndefined(e,"data")&&(n=e.data),o=l.messageExecute(null,l.notUndefined(e,"fn")??null,n),l.messageSendResponse(o,n,t,a)};messageExecute=(e,t,a,n=!1,o={})=>{let i=null,s=a;l.notUndefined(s,"data")&&(s=s.data);let r=[],c=["object","function"],d={};if(null!=self&&(d=self),null!=t&&"function"!=typeof t&&(r="string"==typeof t?t.split("."):t,null==e)){let e=[typeof o<"u"?o:null,typeof d<"u"?d:null,typeof this<"u"?this:null,typeof ServiceWorkerGlobalScope<"u"?ServiceWorkerGlobalScope:null,typeof l<"u"?l:null,l.notUndefined(this,"Browser")?this.Browser():null];if(typeof r.forEach<"u"&&r.forEach((t=>{if(null==i){if(-1!==c.indexOf(typeof t))i=this.messageExecute(null,t,s,n);else for(const a of e)if(null!=a&&l.notUndefined(a,t)&&-1!==c.indexOf(typeof a[t])){i=this.messageExecute(null,a[t],s,n);break}}else i=i[t]??null})),"function"!=typeof i)return i??null;t=i}if(null!=e){if("object"==typeof e[t]&&typeof e[t].then>"u"||!0===n)return e[t]}else if(!0===n)return t;if("object"==typeof t&&null!=t&&"function"==typeof t.then)return t();if(null==e&&"object"==typeof t)return t;try{return null==e&&"function"==typeof t?Array.isArray(s)?t(...s):t(s):null==e&&null!=t?t:"object"==typeof e&&"function"==typeof e[t]?Array.isArray(s)?e[t](...s):e[t](s):null==e?void 0:typeof e[t]<"u"&&typeof e[t].then>"u"&&"object"==typeof e?e:Array.isArray(s)?e[t](...s):e[t](s)}catch{return null==e&&"function"==typeof t?t():null==e&&null!=t?t:null==e?void 0:typeof e[t]<"u"&&"object"==typeof e&&"function"==typeof e[t]?e[t]():"object"==typeof e&&typeof e[t].then>"u"?e:e[t]()}};messageSendResponse=(e,t,a,n,o={})=>{let i=null,s=l.notUndefined(t,"type")??"scripting",r=l.notUndefined(t,"callback")??null;if(r){i=this.messageExecute(null,t.callback,e,!0,o);let a=i.name;t.callback=i,t.callback_name=a}if(null==e)return n({received:!0,return_data:e});if("object"==typeof e&&"function"==typeof e.then){let i;return n({received:!0,return_data:e.then((e=>{if(typeof e<"u"&&typeof e.text<"u"&&(e=e.text()),typeof e<"u"&&typeof e.json<"u"&&(e=e.json()),typeof t.callback<"u"&&t.callback){let n=this.messageExecute(null,t.callback,e,!0,o),i=n.name;if(t.callback=n,t.callback_name=i,"scripting"==s)if(null==a)n(e,t);else{let o={target:{tabId:a.tab.id},function:n,args:[e,t]};l.Browser().scripting.executeScript(o).then()}else{let n=l.notUndefined(a.tab,"id")??null;null!=n&&null==d.runtime_id?(r=this.messageExecute(null,r,{result:e,data:t},!0,o),r&&r(e,t)):l.sendMessage(r,{data:{result:e,data:t}},null,"tabs","tabs",n)}}return e}))})}if(typeof t.callback<"u"&&null!=t.callback&&null!=i&&"function"==typeof t.callback){let n=this.messageExecute(null,t.callback,e,!0,o),i=n.name;if(t.callback=n,t.callback_name=i,"scripting"==s)if(null==a)n(e,t);else{let o={target:{tabId:a.tab.id},function:n,args:[e,t]};l.Browser().scripting.executeScript(o).then()}else{let n=l.notUndefined(a.tab,"id")??null;null!=n&&null==d.runtime_id?(i=this.messageExecute(null,i,{result:e,data:t},!0,o),i&&i(e,t)):l.sendMessage(i,{data:{result:e,data:t}},null,"tabs","tabs",n)}}return n({received:!0,return_data:e})};customAddListener=(e,t=[],a=[])=>{t.forEach((t=>{e[t].addListener(((e,t,l)=>{let n=!1;typeof e.status<"u"&&(t=e,e=(l=e).id),typeof t<"u"?typeof t.status<"u"&&typeof l.url<"u"&&"complete"===t.status&&-1===l.url.indexOf("chrome://")&&(n=!0):(typeof e.name<"u"||typeof e.title<"u"||Object.keys(e).length>0)&&(n=!0),n&&(a.forEach((a=>{let n=!1;"function"==typeof a?a(e,t,l):(typeof window<"u"&&!1===n&&"function"==typeof window[a]&&"function"==typeof window[a].apply&&(window[a].apply(e,t,l),n=!0),typeof ServiceWorkerGlobalScope<"u"&&!1===n&&"function"==typeof ServiceWorkerGlobalScope[a]&&ServiceWorkerGlobalScope[a](e,t,l),typeof this<"u"&&!1===n&&"function"==typeof this[a]&&this[a].call(e,t,l))})),C.debugMode&&console.log(e,t,l,a))}))}))};apiCall=async(e,t={},a="GET",n=6e4)=>{null==t&&(t={}),d.debugMode&&console.log(e,t,"Call");let o={headers:{accept:"application/json",hopekey:f.Local.uuid_hopekey??null},method:a};null!=d.runtime_id&&"/extensions/app/get_key"==e&&null==o.headers.hopekey&&delete o.headers.hopekey,null==d.runtime_id&&typeof window<"u"&&"function"==typeof window.getCookie&&(o.headers.hopekey=window.getCookie("hopekey")??f.Local.uuid_hopekey??null,null==o.headers.hopekey&&delete o.headers.hopekey);let i=-1!==e.indexOf("://")?e:`${d.api_url}${e}`;if(typeof f.Local<"u"){let e=f.Local;typeof e.settings<"u"&&l.notUndefined(e.settings,"language")&&(t.lang=e.settings.language)}return typeof t.uuid_search>"u"&&l.notUndefined(f.Local,"uuid_search")&&(t.uuid_search=l.notUndefined(f.Local,"uuid_search")),typeof t.uuid_hopekey>"u"&&l.notUndefined(f.Local,"uuid_hopekey")&&(t.uuid_hopekey=l.notUndefined(f.Local,"uuid_hopekey")),null!=d.runtime_id?(t.v=l.Browser().runtime.getManifest().version??null,t.ri=l.Browser().runtime.getManifest().id??d.runtime_id):t.v=d.version??null,Object.keys(t).length>0&&(o.body=JSON.stringify(t)),await l.fetchWithTimeout(i,o,n).then((e=>{try{return e.json()}catch{return e.text()}})).then((a=>{a=this.ajaxResponse(this.ajaxResponseChipper(a),0,1),d.debugMode&&console.log(e,t,a);try{return a}catch{return a}})).catch((o=>{if(d.api_call_try<d.api_call_max_try&&-1===i.indexOf("languages/lang/sync"))return setTimeout((()=>(console.error("Try",d.api_call_try,i,t,a,n),d.api_call_try++,l.apiCall(e,t,a,n))),1e4);console.warn(o)}))};ajaxResponse=(e,t=0,a=1)=>{if(typeof e>"u")return!1;if(1==t)return;if(typeof e.debug_time<"u"&&2!=d.debugMode)if(1==d.debugMode)console.log(e.redirect_uri,e.debug_time);else{let t={[e.redirect_uri]:e.debug_time};d.debug_time=Object.assign(d.debug_time,t)}let n={};return typeof e.languages<"u"&&(n.languages=e.languages,typeof f.Local<"u"&&(f.Local.languages=e.languages),typeof e.expire<"u"&&l.Browser().storage.local.get("expires").then((t=>{n.expires=t.expires??{},"object"!=typeof n.expires&&(n.expires={}),n.expires.languages=e.expire,f.Local.expires=n.expires,l.Browser().storage.local.set({expires:n.expires}).then(d.debugMode?console.log:null)}))),typeof e.expire<"u"&&typeof e.expire.name<"u"&&typeof e.expire.time<"u"&&l.Browser().storage.local.get("expires").then((t=>{n.expires=t.expires??{},"object"!=typeof n.expires&&(n.expires={}),n.expires[e.expire.name]=e.expire.time,f.Local.expires=n.expires,l.Browser().storage.local.set(n).then(d.debugMode?console.log:null)})),typeof e.language_variables<"u"&&typeof e.language_variables.variables<"u"&&(n.language_variables=e.language_variables.variables,typeof f.Local<"u"&&(f.Local.language_variables=e.language_variables.variables)),"object"==typeof n&&Object.keys(n).length>0&&(d.debugMode&&console.log(n,e,"STORAGE_SET"),l.Browser().storage.local.set(n).then(d.debugMode?console.log:null)),typeof e.notifications<"u"&&typeof document<"u"&&e.notifications&&Object.keys(e.notifications).forEach((t=>{t=e.notifications[t],typeof this.notify[t.type]<"u"&&this.notify[t.type](t.message)})),typeof e.data<"u"&&1==a?e.data:e};firstUpperCase=e=>`${e.substring(0,1).toUpperCase()}${e.substring(1)}`;ucFirstUpperCase=(e,t)=>{let a=e.split(t);return a.forEach(((e,t)=>{a[t]=`${e.substring(0,1).toUpperCase()}${e.substring(1)}`})),a.join(t)};JsonParse=e=>{let t=e;if(typeof e<"u"||null!=e)try{"string"==typeof e&&(t=JSON.parse(e)),"object"==typeof t&&Object.keys(t).length>0&&Object.keys(t).forEach((e=>{("object"==typeof t[e]||"string"==typeof t[e]&&(-1!==t[e].indexOf("{")&&-1!==t[e].indexOf("}")||-1!==t[e].indexOf("[")&&-1!==t[e].indexOf("]")))&&(t[e]=this.JsonParse(t[e]))}))}catch{}return t};settingsBuild=async(e=!1)=>new Promise((async(t,a)=>await l.Browser().storage.local.get(["settings","domain","languages"]).then((async a=>{if(typeof a.domain>"u"&&null!=a.domain&&l.domainByUrls(a.domain),a.settings){let e=!1;null!==a.settings.language&&(l.notUndefined(a.settings,"language_detail.lang_code")!==a.settings.language&&(e=!0),e&&null!==a.settings.language&&(y.language_detail=a.settings.language_detail=l.notUndefined(a.languages,`${a.settings.language}`),y.language_name=a.settings.language_name=l.notUndefined(a.languages,`${a.settings.language}.title`)))}return typeof a.settings>"u"?await l.Browser().storage.local.set({settings:y}).then((async()=>(await l.getLanguages(!0,y.language).then(),l.getActiveHistories(),await l.getModelSettings(),l.removeLoading(),t(y)))):(Object.keys(y).forEach((e=>{if(typeof y[e]<"u"){let t=y[e];a.settings&&typeof a.settings[e]>"u"&&(a.settings[e]=t)}})),a.settings&&l.Browser().storage.local.set({settings:a.settings}).then((async()=>{1==e&&(await l.getLanguages(!1,a.settings.language).then(),await l.getModelSettings(),await l.uuid(1==e?1:0))})),l.removeLoading(),t(a))}))));uuid=async(e=0)=>(l.removeFirstLoading(),new Promise((async(t,a)=>await l.Browser().storage.local.get().then((async n=>{f.Local=n,typeof n.developer<"u"&&null!=n.developer&&(l.notUndefined(n.developer,"beta_api")&&(d.api_url=`https://beta_api.${d.domain}`),l.notUndefined(n.developer,"debug_log")&&(d.debugMode=1)),l.Browser().storage.sync&&l.Browser().storage.sync.get().then((async e=>{f.Sync=e})),l.notUndefined(n,"settings")||(n.settings=y),null==n.settings&&(n.settings=y,n.settings.language=y.language,l.Browser().storage.local.set({settings:n.settings}).then()),d.debugMode&&console.log(y,365),null==typeof n.settings&&(n.settings=y),d.debugMode&&console.log(n.settings,367),typeof n.settings<"u"&&null!=n.settings&&typeof n.settings.ai_mode>"u"&&(n.settings=y);let o={ai_mode:n.settings.ai_mode,lang:n.settings.language,model:n.settings.ai_model,settings:n.settings};if(e||null==d.runtime_id&&typeof window<"u"&&(n.uuid_hopekey!=(window.getCookie("hopekey")??"nullS")||window.getCookie("aitopia_check_login"))&&(window.eraseCookie("aitopia_check_login"),e=1),e||!(typeof n.credit_usage<"u")||null==(n.uuid_hopekey??null))return"api"==o.ai_mode&&(o.ai_key=n.settings.ai_key),l.notUndefined(o.settings,"language_detail.variables")&&(delete o.settings.language_detail.variables,l.Browser().storage.local.set({settings:o.settings}).then()),await this.apiCall("/extensions/app/get_key",o,"POST").then((e=>{if(e){if(typeof e.key<"u"){f.Local.uuid_hopekey=e.key;let t={licences:null==e?void 0:e.licences,credit_usage:e.credit_usage,credit_detail:e.credit_detail,credit_detail_visual:e.credit_detail_visual,ai_models:e.models,ai_type_models:e.type_by_models,image_editing:e.image_editing,google_auth_uri:e.google_auth_uri??null,user:null,email:null,uuid_hopekey:e.key,uuid_search:e.search_key,plan:e.plan.toCapitalizeCase()};l.notUndefined(e,"domain")&&(t.domain=e.domain,l.domainByUrls(e.domain)),typeof e.show_review<"u"&&(t.show_review=e.show_review),f.Local.settings&&"free"==e.plan&&typeof f.Local.settings.web_access<"u"&&(f.Local.settings.web_access=!1,t.settings=f.Local.settings),typeof e.user<"u"&&(t.user=e.user,typeof e.user.email<"u"&&(t.email=e.user.email)),typeof e.expire<"u"&&(l.notUndefined(f.Local,"expires")||(f.Local.expires={}),f.Local.expires.credits=e.expire,t.expires=f.Local.expires,d.debugMode&&console.log(f.Local.expires),d.debugMode&&console.log(t)),typeof window<"u"&&null!=t.uuid_hopekey&&d.domain_allows.forEach((e=>{window.setCookie("hopekey",t.uuid_hopekey,360,"."+e),window.setCookie("ait_app",!0,360,"."+e),window.eraseCookie("aitopia_check_login","."+e)})),l.Browser().storage.local.set(t).then((()=>l.removeLoading())),f.Local=Object.assign(f.Local,t)}return t(e)}})).catch((e=>(console.log(e),a())));l.removeLoading()})))));pricingDetail=()=>l.Browser().storage.local.get().then((e=>{if(f.Local=e,typeof e.packages<"u"&&(null==e.packages||""==e.packages)&&delete e.packages,typeof e.packages>"u")return this.apiCall("/extensions/app/get_pricing",null,"POST").then((e=>{if(e&&typeof e.packages<"u"){let t={packages:e.packages,faq:e.faq};f.Local=Object.assign(f.Local,t),typeof f.Local.expires>"u"&&(f.Local.expires={}),f.Local.expires.packages=e.expire,l.Browser().storage.local.set(t).then()}}))}));ajaxResponseChipper=e=>{if("string"!=typeof e)return e;try{return JSON.parse(M.AES.decrypt(e,"",{format:this.CryptoJSAesJson}).toString(M.enc.Utf8))}catch(t){throw console.log(t),"error"}};CryptoJSAesJson={stringify:function(e){var t={ct:e.ciphertext.toString(M.enc.Base64)};return e.iv&&(t.iv=e.iv.toString()),e.salt&&(t.s=e.salt.toString()),e.key&&(t.k=e.key.toString()),JSON.stringify(t)},parse:function(e){try{let l=M;var t=JSON.parse(e),a=l.lib.CipherParams.create({ciphertext:l.enc.Base64.parse(t.ct)});return t.iv&&(a.iv=l.enc.Hex.parse(t.iv)),t.s&&(a.salt=l.enc.Hex.parse(t.s)),t.s&&(a.key=l.enc.Hex.parse(t.k)),a}catch(l){throw console.log(l),"error"}}};_i;AesEnCrypt(e,t=null){let a=M;var l;return this._i=a.PBKDF2(this.MD5(t??d.hello_world_test),this.SHA1(t??d.hello_world_test),{keySize:8,iterations:100}),a.AES.encrypt(e,this._i,{iv:this._i,padding:a.pad.Pkcs7,mode:a.mode.CBC,hasher:a.algo.SHA256}).toString()}AesDeCrypt(e,t=null){let a=M;var l;return null==this._i&&(this._i=a.PBKDF2(this.MD5(t??d.hello_world_test),this.SHA1(t??d.hello_world_test),{keySize:8,iterations:100})),a.AES.decrypt(e,this._i,{iv:this._i,padding:a.pad.Pkcs7,mode:a.mode.CBC,hasher:a.algo.SHA256}).toString(a.enc.Utf8)}copyClipboard=e=>{let t=document.querySelector("#ait_clipboard");t.value=e,t.focus(),t.select(),document.execCommand("copy",!1,e),t.value="",this.notify&&this.notify.success(this.__("Copied."))};openPage=e=>{if(null==d.runtime_id)return void(0===e.url.indexOf(`.${d.main_dir}`)||0===e.url.indexOf(`${d.main_dir}`)?window.location=e.url.replace(`.${d.main_dir}`,"").replace(`${d.main_dir}`,"").replace(".html",""):window.location=e.url);let t=!1;l.Browser().tabs.query({}).then((a=>{a.forEach((a=>{if(typeof e.url<"u"&&a.id>0){e.url=e.url.replace("./","/");let n=e.url.split("?")[0];if((-1!==e.url.indexOf(d.extension_dir)||"/src/"==e.url.substring(0,5))&&-1!==a.url.indexOf(d.extension_dir))return l.Browser().tabs.update(a.id,{active:!0,url:e.url}).then(),void(t=!0);if(a.url==n||-1!==a.url.indexOf(n)||-1!==n.indexOf(a.url))return a.url==e.url?(chrome.tabs.reload(a.id).then(),l.Browser().tabs.update(a.id,{active:!0}).then()):(chrome.tabs.reload(a.id).then(),l.Browser().tabs.update(a.id,{active:!0,url:e.url}).then()),void(t=!0)}})),0==t&&l.Browser().tabs.create({url:e.url}).then()}))};messageCallback(e,t){e(t)}notUndefinedBuilder=(e,t)=>!1!==t.indexOf(".")?(t.split(".").forEach((t=>{t=t.replace("###","."),typeof e<"u"&&e&&(e=typeof e[t]<"u"?e[t]:null)})),e):!!(typeof e<"u"&&e&&typeof e[t]<"u")&&e[t];notUndefined=(e,t)=>{if(null==t)return!1;if("string"==typeof t)return this.notUndefinedBuilder(e,t);if("object"==typeof t){let a=!0;return null!=t?t.forEach((t=>{this.notUndefinedBuilder(e,t)||(a=!1)})):a=!1,a}return null};SHA1=e=>(e+="_crypt",M.SHA1(e).toString());MD5=e=>(e+="_md5",M.MD5(e).toString());isPinned=e=>{if(null!=e&&document.querySelector(".setup_page #check_toolbar")){let a=document.querySelector(".setup_page #check_toolbar");if(1==e.isOnToolbar){a.value=e.isOnToolbar;var t=new Event("change");a.dispatchEvent(t)}}};minifierExpand=(e,t)=>{let a={};return e&&t?(Object.keys(e).forEach((l=>{let n=e[l];n&&Object.keys(n).forEach((e=>{let o=n[e];typeof a[l]>"u"&&(a[l]={}),a[l][t[e]]=this.JsonParse(o)}))})),a):e};filenameByFaIcon(e,t=null){let a=null;const l={excel:["xlsx","xls"],word:["doc","docx"],powerpoint:["pptx","ppt"],pdf:["pdf"],image:["jpg","jpeg","webp","png","tiff","svg","gif","avif","apng"],video:["webm","mkv","flv","flv","vob","ogv","ogg","drc","gif","gifv","mng","avi","MTS","M2TS","TS","mov","qt","wmv","yuv","rm","rmvb","viv","asf","amv","mp4","m4p","m4v","mpg","mp2","mpeg","mpe","mpv","mpg","mpeg","m2v","m4v","svi","3gp","3g2","mxf","roq","nsv","flv","f4v","f4p","f4a","f4b"],zipper:["zip","rar","7z"],audio:["mp3","wav","ogg","flac","aac","wma","m4a","ape","alac","aiff","mid","amr","pcm","au","ra","aac","ac3","dts","mka","opus","midi","3ga","webm","caf","m4r","tta","wv"],code:["php","html","css","js","py","java","c","cpp","h","hpp","xml","json","sql","rb","swift","kt","pl","go","ts","dart","sh","bat","ps1"]},n={excel:"#1d6f42",word:"#41A5EE",powerpoint:"#D04423",pdf:"#f40f02"};return Object.keys(l).forEach((o=>{l[o].forEach((l=>{if(-1!==e.indexOf(`.${l}`))return a=o,null==t&&(t=n[o]??t),{name:a,color:t}}))})),null==a&&(a="lines"),""==t&&(t=null),{name:a,color:t}}async getModelSettings(){return await new Promise((async(e,t)=>await l.Browser().storage.local.get("model_settings").then((async t=>{if(typeof t.model_settings<"u"&&null!=t.model_settings&&Object.keys(t.model_settings).length>0)return await e(t.model_settings);await l.apiCall("/ai/model_settings",{},"POST").then((async e=>e?(await l.Browser().storage.local.set({model_settings:e}),e):setTimeout(l.getModelSettings,1e3))),e(t)}))))}slugify=e=>e.toString().toLowerCase().replace(/\s+/g,"-").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"-").replace(/^-+/,"").replace(/-+$/,"");vueDefaultChecker(e,t,a,n,o=null,i=!0){if(a=l.notUndefined(a,l.notUndefined(n,"model_prefix")),0!=i)return a===o;if(null!=o&&null!=a)return a!=o?null:o;let s=l.notUndefined(e,t);if(null!=s)return s;let r=s??l.notUndefined(e,l.notUndefined(n,"model_default"))??o??l.notUndefined(n,"default"),c=!0;return typeof a<"u"&&(c=a==r),0==i?typeof r>"u"?null:r:(1==c&&null!=r&&l.notUndefined(f.Local,t),c)}autoHeightTextArea(e,t=null){e.style.height="unset",null==t&&(t=e.style.maxHeight.match(/[-+]?([0-9]*\.[0-9]+|[0-9]+)/)[0]??200),t<=e.scrollHeight&&(e.style.height=e.scrollHeight+"px")}getReadableFileSizeString(e){var t=-1,a=[" kB"," MB"," GB"," TB","PB","EB","ZB","YB"];do{e/=1024,t++}while(e>1024);return Math.max(e,.1).toFixed(2)+a[t]}__(e,t="tr"){if(null==e)return e;let a=M.SHA1(e).toString(),n=d.lang_cache_type;return null!=y&&"object"==typeof f.Local.languages&&typeof y.language<"u"&&null!==f.Local.languages&&null!==y.language&&typeof f.Local.languages[y.language]<"u"&&(null==y.language_name||""==y.language_name)&&typeof f.Local.languages[y.language].name<"u"&&typeof f.Local.settings<"u"&&(l.notUndefined(f.Local,"settings.language")&&(y.language=l.notUndefined(f.Local,"settings.language")),f.Local.settings.language_name=y.language_name=f.Local.languages[y.language].name,f.Local.settings.language_detail=y.language_detail=f.Local.languages[y.language],l.Browser().storage.local.set({settings:f.Local.settings}).then()),typeof f<"u"&&null!==y.language_name&&typeof f[n]<"u"&&l.notUndefined(f[n],"language_variables")&&typeof f[n].language_variables[a]<"u"?f[n].language_variables[a]:e=this.setLangVar(a,e)}async getLanguages(e=!1,t=null,a=null){let n=d.lang_cache_type;t=t??f[n].settings.language??y.language;let o=!1;if(typeof f[n].languages<"u"&&(0==Object.keys(f[n].languages??{}).length||null==f[n].languages||"{}"==f[n].languages)&&(delete f[n].languages,delete f[n].language_variables,delete f[n].language_var_sync),typeof f[n].languages>"u"||e)return null!=a&&(f[n].settings.language=a.settings.language=t),typeof f[n].languages>"u"&&(f[n].languages={},o=!0),await l.apiCall("/languages/lang/get/lang/"+t,{language:t},"POST").then((e=>{try{return typeof e>"u"||typeof e.languages>"u"?void 0:(e=l.JsonParse(e),o&&l.Browser().storage[n.toLowerCase()].set({languages:JSON.stringify(e.languages)}).then(),typeof e.expire<"u"&&(l.notUndefined(f.Local,"expires")||(f.Local.expires={}),f.Local.expires.languages=l.JsonParse(e.expire),l.Browser().storage[n.toLowerCase()].set({expires:f.Local.expires}).then()),f[n].language_variables=l.JsonParse(e.language_variables.variables),f[n].languages=l.JsonParse(e.languages),l.Browser().storage[n.toLowerCase()].set({language_variables:JSON.stringify(e.language_variables.variables),languages:f[n].languages}).then((e=>l.Browser().storage[n.toLowerCase()].get("settings").then((e=>(f[n].settings=e.settings??y,f[n].settings.language_name=y.language_name=f[n].languages[t].name,f[n].settings.language_detail=y.language_detail=f[n].languages[t],f[n].settings.language=y.language=t,l.Browser().storage.local.set({settings:f[n].settings}).catch((e=>console.log(e))).finally((()=>{typeof a<"u"&&null!=a&&"function"==typeof a.changeSettings&&(a.changeSettings(),1==Object.keys(a.ai_chat).length&&"function"==typeof a.newChat&&a.newChat()),l.Browser().tabs&&l.Browser().tabs.query({url:d.site+"/*"}).then((e=>{e.forEach((e=>{null!=t&&null!=l.Browser().scripting&&"complete"==e.status&&l.Browser().scripting.executeScript({target:{tabId:e.id},func:this.changeSiteLanguage,args:[t]}).catch((t=>{console.warn(t,e)})).then()}))}))}))))))))}catch(i){console.log(i)}}))}changeSiteLanguage=(e=null)=>{if(null==e){let t=f.Local;typeof t.settings<"u"&&typeof t.settings.language<"u"&&null!=t.settings.language&&(e=t.settings.language)}null!=e&&(window.lang=e,localStorage.getItem("lang")!=window.lang&&(localStorage.setItem("lang",e),localStorage.removeItem("languages"),localStorage.removeItem("language_variables")))};setLangVar(e,t){let a=d.lang_cache_type,n=!1;if(!(null==t||typeof f>"u"||typeof f[a]>"u"))return typeof f[a].language_variables>"u"&&(f[a].language_variables={}),l.notUndefined(f[a],"language_variables")||(f[a].language_variables={}),l.notUndefined(f[a].language_variables,e)||(n=!0),"string"==typeof f[a].language_variables&&null!=f[a].language_variables&&(f[a].language_variables=JSON.parse(f[a].language_variables)),"object"!=typeof f[a].language_variables&&(f[a].language_variables=[]),f[a].language_variables&&(f[a].language_variables[e]=t),"development"!=d.mode||t&&0==n||(typeof f[a].language_var_sync>"u"&&(f[a].language_var_sync={}),("object"!=typeof f[a].language_var_sync||null==f[a].language_var_sync)&&(f[a].language_var_sync={}),f[a].language_var_sync[e]=t,l.Browser().storage[a.toLowerCase()].set({language_var_sync:JSON.stringify(f[a].language_var_sync)}).then()),t}async captureCurrentViewport(){return new Promise(((e,t)=>{console.log(l.Browser().tabs,l.Browser().tabs.captureVisibleTab),l.Browser().tabs.captureVisibleTab(void 0,{format:"jpeg",quality:80}).then((a=>a?e(a):t(null)))}))}setAIImageURL(e){let t=d.lang_cache_type;typeof f[t]>"u"||(l.Browser().storage[t.toLowerCase()].set({ai_image_url:e}).then(),typeof f[t].ai_image_url>"u"&&(f[t].ai_image_url={}),f[t].ai_image_url=e)}syncLangVar(){setTimeout((()=>{if("development"!=d.mode)return;let e=d.lang_cache_type;if(l.Browser().storage[e.toLowerCase()].set({language_var_sync:JSON.stringify(f[e].language_var_sync)}).then(),l.Browser().storage[e.toLowerCase()].set({language_variables:JSON.stringify(f[e].language_variables)}).then(),typeof f[e].language_var_sync<"u"){if(!l.notUndefined(f[e],"language_var_sync"))return;let t=f[e].language_var_sync;if(Object.keys(t).length>0){let a={data:t,language:"en"};l.apiCall("/languages/lang/sync",a,"POST",-1).then((t=>{l.Browser().storage[e.toLowerCase()].remove(["language_var_sync"]).then()}))}}}),2e3)}auth(e,t,a="register",l){let n=l.target,o=!1;n.setAttribute("disabled","disabled");let i=n.closest(`#${a}`);document.querySelectorAll(".input-error").forEach((e=>{e.classList.remove("input-error")}));let s=/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/;return null==t.email&&(t.email=""),(t.email.length<3||!t.email.match(s))&&(null!=i&&i.querySelector('[name="email"]').classList.add("input-error"),this.notify.error(this.__("Please check your e-mail address.")),o=!0,n.removeAttribute("disabled")),"register"==a?(null==t.password&&(t.password=""),null==t.password1&&(t.password1=""),null==t.agree&&(t.agree=!1),t.password.length<3&&(null!=i&&i.querySelector('[name="password"]').classList.add("input-error"),this.notify.error(this.__("Please check your password.")),n.removeAttribute("disabled"),o=!0),t.password1.length<3&&(null!=i&&i.querySelector('[name="password1"]').classList.add("input-error"),this.notify.error(this.__("Please check your confirm password.")),n.removeAttribute("disabled"),o=!0),t.password1!=t.password&&(e.forms.password1=null,null!=i&&i.querySelector('[name="password1"]').classList.add("input-error"),this.notify.error(this.__("Your passwords do not match. Please check and try again.")),n.removeAttribute("disabled"),o=!0),0==t.agree&&(null!=i&&i.querySelector('[name="agree"]').classList.add("input-error"),this.notify.error(this.__("I have read and agree to terms.")),n.removeAttribute("disabled"),o=!0),1==o?void 0:this.apiCall("/auth/register",t,"POST").then((t=>{if(!(typeof t.status<"u"&&"error"==t.status))return this.uuid(1).then((()=>{e.login=!0,n.removeAttribute("disabled")}));n.removeAttribute("disabled")}))):"login"==a?(null==t.password&&(t.password=""),t.password.length<3&&(null!=i&&i.querySelector('[name="password"]').classList.add("input-error"),this.notify.error(this.__("Please check your password.")),n.removeAttribute("disabled"),o=!0),1==o?void 0:this.apiCall("/auth/login",t,"POST").then((t=>{if(!(typeof t.status<"u"&&"error"==t.status))return"success"==t.status?this.uuid(1).then((()=>{e.login=!0,n.removeAttribute("disabled")})):t;n.removeAttribute("disabled")}))):"recover"==a?1==o?void 0:this.apiCall("/auth/reset_password",t,"POST").then((t=>{if(!(typeof t.status<"u"&&"error"==t.status))return"success"==t.status?(e.login_type="login",n.removeAttribute("disabled"),!0):t;n.removeAttribute("disabled")})):void 0}scrollToBottom(e="#ai-message-container,#ait-prompt-container",t=null){document&&document.querySelectorAll(e).forEach((e=>{let a=e;setTimeout((()=>{typeof a.scrollTop<"u"&&(a.scrollTop=t??a.scrollHeight+5e4)}),75)}))}newChatId(){return Date.now()}ChatId(e,t,a=0){let n=null,o=f.Local.ai_chat_ids??{};return typeof o<"u"&&0==a&&typeof o[e]<"u"&&(null!=t&&"__all"!=t?(o[e][t]||"number"==typeof o[e])&&(n=o[e][t]):n=o[e]),null==n&&(a=1),e&&1==a&&(t?((typeof o[e]>"u"||"object"!=typeof o[e])&&(o[e]={}),n=o[e][t]=this.newChatId()):n=o[e]=this.newChatId()),l.Browser().storage.local.set({ai_chat_ids:o}).then(),n}GoogleSearchCall=async e=>{if(null==d.runtime_id)return!1;let t=l.notUndefined(f.Local,"settings.language")??null;if(null==t)try{return fetch("https://www.google.com/search?q="+e+"&sourceid=chrome&ie=UTF-8").then((e=>e.text())).catch(console.log)}catch{return!1}try{return fetch(`https://www.google.com/search?hl=${t}&lr=lang_${t}&as_q=${e.replace(/ /gi,"+")}&sourceid=chrome&ie=UTF-8`).then((e=>e.text())).catch(console.log)}catch{return!1}};GoogleSearchCallback=async(e,t={},a=!0)=>{let n=null;"object"==typeof e&&typeof e.result<"u"&&(t=e.data??{},e=e.result??{},n=l.notUndefined(t,"data"));let o=(new DOMParser).parseFromString(e,"text/html"),i="",s={},r=0,c="",u="",g={},p=o.querySelector("#search block-component table");null!=p&&(p=p.outerHTML);let _="";if(null!=p){let e=o.querySelectorAll("#search block-component table");null!=o.querySelector("#search block-component table table")&&(e=o.querySelectorAll("#search block-component table table")),e.forEach((e=>{e.querySelectorAll("tr").forEach(((e,t)=>{let a=e;null!=a.querySelector("th")?(a.querySelectorAll("th").forEach((e=>{let t=e;null!=t.querySelector('span[aria-hide],[class*="hide"]')?null!=t.querySelector("* span:last-child")&&(_+="  "+t.querySelector("* span:last-child").innerText.trim()):_+="  "+t.innerText.trim()})),_=_.trim()+"\n"):(a.querySelectorAll("td").forEach((e=>{let t=e;null!=t.querySelector("span[aria-hide]")?null!=t.querySelector("* span:last-child")&&(_+="  "+t.querySelector("* span:last-child").innerText.trim()):_+="  "+t.innerText.trim()})),_=_.trim()+"\n")}))}))}null!=o.querySelectorAll("#search [data-snc]")&&o.querySelectorAll("#search [data-snc]").forEach(((e,t)=>{Object.keys(s).length<=(d.web_access_search_limit??5)&&(e.querySelectorAll("[data-sncf],[data-snhf]").forEach(((e,t)=>{let a=!1,l=e,n=l.querySelector("a h3"),o=null;if(null!=n&&(a=!0,c=n.closest("a").getAttribute("href"),u=n.innerText),a||(o=l.querySelectorAll("a"),null!=o&&o.forEach((e=>{g[e.innerText]=e.getAttribute("href")}))),-1===l.innerHTML.indexOf('role="img"')&&!a){let e=l.innerText.split(" — ");i+=e[1]??e[0]}l.getAttribute("data-sncf")})),s[r]={text:i,url:c,title:u,sub_links:g},u=c=i="",g={},r++)}));let m=null;null!=o.querySelector("#search [data-entityname] [data-domdiff]")&&(m=o.querySelector("#search [data-entityname] [data-domdiff]").innerText.replace(/\n/gi," ")??null);let h=[];null!=o.querySelector("#search [data-q]")&&o.querySelectorAll("#search [data-q]").forEach((e=>{h.push(e.innerText)}));let b="";null!=o.getElementById("rhs")&&(null!=o.querySelector("g-card-section")&&o.querySelectorAll("g-card-section").forEach((e=>{if(null==e.closest('[role="button"]')){let t=e.innerText;t.length>0&&(b+="\n"+t)}})),null!=o.querySelector("#rhs g-link")&&o.querySelectorAll("#rhs g-link").forEach((e=>{if(null==e.closest('[role="button"]')){let t=e.innerText;t.length>0&&(b+="\n"+t)}})),o.querySelectorAll("#rhs [data-maindata]+div span,#rhs [data-maindata]+div .title").forEach((e=>{let t=e;null==t.closest('[role="button"]')&&t.innerText&&(b+="\n"+t.innerText)})),""==b&&(b=b.trim()));let w={};try{w={original_ask:n,data:s,extra:m,questions:h,detail:b,table:_}}catch{}let x=!1;if(Object.keys(l.notUndefined(w,"data")).length>0&&(x=!0),!x&&(l.notUndefined(e,"data.data")||l.notUndefined(t,"data"))){let a=await this.apiCall("/ai/search",{q:l.notUndefined(e,"data.data")||l.notUndefined(t,"data"),lang_code:l.notUndefined(f.Local,"settings.language")??null,model:y.ai_model},"POST");l.notUndefined(a,"data")&&(w={original_ask:l.notUndefined(a,"original_ask"),data:l.notUndefined(a,"data"),extra:null,questions:l.notUndefined(a,"questions"),detail:null,table:null})}if(a){let e=typeof l.Browser().web_access_mode<"u"?l.Browser().web_access_mode:"ai_chat",t=typeof l.Browser().web_access_extra_key<"u"?l.Browser().web_access_extra_key:"__all";G.chat(n,y.ai_model,e,t,!0,!1,null,!0,{search:w,web_access:!0})}return new Promise(((e,t)=>e(w)))};cleanTextEmpty(e){return e&&e.replace(/[\r\n]+/gm," ").replace(/[\t]+/gm," ").replace(/[\s]+/gm," ").trim()}setSidebar(){if(!document)return;let e=document.createElement("div");e.id="aitopia-container";let t=document.createElement("div");t.id="aitopia",null!=document.querySelector("#aitopia-full-screen")?(t.id="aitopia-full",document.querySelector("#aitopia-full-screen").classList.add("aitopia")):t.classList.add("aitopia"),t.append(e);let a=document.querySelector("body");if(-1==(a.getAttribute("id")??"").indexOf("aitopia")){let e="html";a=document.querySelector(e)}null==a||a.append(t)}tabExtensionPage=(e=null)=>{if(l.notUndefined(e,"filters")){let t=!0;return l.Browser().tabs.query(l.notUndefined(e,"filters")).then((a=>{a.forEach((a=>{if(t=!1,l.notUndefined(e,"filter_url")?-1!==a.url.indexOf(l.notUndefined(e,"filter_url"))&&(t=!0):t=!0,console.log(t,l.notUndefined(e,"filter_url")),l.notUndefined(e,"url")&&t&&(e.active=!0,l.Browser().tabs.update(a.id,{url:e.url}).then()),t)return a}))}))}};removeEmptyLines(e){return e&&e.replace(/^\s*[\r\n]/gm,"").trim()}treeKeybyValueBuild(e,t,a,l=".",n=0,o={}){return"object"!=typeof e&&(e=e.split(l)),typeof e[n]>"u"?t:(typeof a[e[n]]<"u"&&(o[e[n]]=a[e[n]]),o[e[n]]=this.treeKeybyValueBuild(e,t,a,l,n+1,o[e[n]]??{}),o)}Browser(){return d.Browser}addLoading(){if(null==d.runtime_id&&typeof document<"u"){let e="body > .aitopia";return null==d.runtime_id&&(e="body.aitopia"),void(null!=document.querySelector(e)&&null==document.querySelector(e+".ait-page-loading")&&document.querySelector(e).classList.add("ait-page-loading"))}}removeLoading(){let e=".ait-page-loading-container";if(null!=d.runtime_id&&(e="#aitopia-full-screen .ait-page-loading-container"),typeof document<"u"&&null!=document.querySelector(e)&&(document.querySelectorAll(e).forEach((e=>e.classList.add("ait-loading-calm"))),document.querySelectorAll(e).forEach((e=>e.remove())),setTimeout((()=>{document.querySelectorAll(e).forEach((e=>e.remove())),l.scrollToBottom()}),5)),typeof document<"u"){let e="body > .aitopia";null==d.runtime_id&&(e="body.aitopia"),setTimeout((()=>{null!=document.querySelector(e+".ait-page-loading")&&document.querySelector(e+".ait-page-loading").classList.remove("ait-page-loading"),l.scrollToBottom()}),1)}}removeFirstLoading(){null==d.runtime_id&&typeof document<"u"&&null!=document.querySelector(".ait-page-loading-container")&&(document.querySelectorAll(".ait-page-loading-container").forEach((e=>e.classList.add("ait-loading-calm"))),document.querySelectorAll(".ait-page-loading-container").forEach((e=>e.remove())),setTimeout((()=>{document.querySelectorAll(".ait-page-loading-container").forEach((e=>e.remove()))}),5))}async getIpDetail(){return{}}SyncAppAndExtensionOrTabs=async(e=null)=>{"object"==typeof e&&null!=e&&0==Object.keys(e).length&&(e=null);let t=null;null==d.runtime_id&&(t=d.domain);let a=!0,n=!1;null!=e&&(typeof e.back<"u"&&(a=!1),typeof e.type<"u"&&(n=e.type),typeof e.setter_domain<"u"&&(t=e.setter_domain),typeof e.storage<"u"&&(e=e.storage));let o={storage:e,type:n,setter_domain:t};if(null!=d.runtime_id)return null!=e&&await l.GetSetSyncData(o),await l.TabMessageSync({target:null,function:async e=>(e.back=!1,await window.postMessage({fn:"SyncAppAndExtensionOrTabs",data:e})),args:[o]},t);if(null==e){if(!l.notUndefined(d.ExtensionBrowser,"runtime.sendMessage"))return!1;o.storage=await l.GetSetSyncData();let e=await d.ExtensionBrowser.runtime.sendMessage(d.manuel_extension_id,{fn:"GetSetSyncData",data:o});if(o.storage=l.notUndefined(e,"return_data"),o.type=!0,"object"==typeof o.storage&&null!=o.storage&&0==Object.keys(o.storage).length&&(o.storage=null),null==o.storage)return{}}else if(o.type=!1,a){if(!l.notUndefined(d.ExtensionBrowser,"runtime.sendMessage"))return!1;await d.ExtensionBrowser.runtime.sendMessage(d.manuel_extension_id,{fn:"SyncAppAndExtensionOrTabs",data:o})}return await l.GetSetSyncData(o)};GetSetSyncData=async(e=null)=>{if(null!=e){let t=!1;l.notUndefined(e,"setter_domain")&&l.notUndefined(e,"setter_domain"),typeof e.type<"u"&&(t=e.type);let a=l.notUndefined(f.Local,"migration"),n=l.notUndefined(e,"storage.local.migration");return null==n&&(n=l.notUndefined(e,"storage.local.ai_chat_ids.ai_chat")),0==t&&(t=a<n||null==a),1==t&&l.notUndefined(e,"storage")?(Object.keys(e.storage).forEach((t=>{if(l.notUndefined(l.Browser().storage,t)){let o=t.toCapitalizeCase();null==a&&(e.storage.local.migration=n??(new Date).getTime()),e.storage[t]&&(e.storage[t]=l.JsonParse(e.storage[t]),(typeof e.storage[t].settings>"u"||null!=l.notUndefined(e.storage[t],"settings"))&&(f.Local.migration_status=!0,e.storage[t].migration_status=!0,l.Browser().storage[t].set(e.storage[t]).then((()=>{f.Local.migration_status=!1,l.Browser().storage.local.set({migration_status:!1}),f[o]=Object.assign(f[o],e.storage[t])}))))}})),{}):{local:l.JsonParse(f.Local),sync:l.JsonParse(f.Sync),runtime_id:d.runtime_id}}return{local:l.JsonParse(f.Local),sync:l.JsonParse(f.Sync),runtime_id:d.runtime_id}};TabMessageSync=async(e,t=null)=>{if(l.notUndefined(l.Browser().tabs,"query")&&d.domain_allows&&e){let a=/^(?:https?:\/\/)?(?:[^@\n]+@)?(?:www\.)?([^:\/\n\?\=]+)/im,n=Object.values(d.domain_allows);null!=t&&-1!==n.indexOf(t)&&n.splice(n.indexOf(t),1),n.forEach((t=>{l.Browser().tabs.query({status:"complete"}).then((n=>{n.forEach((async n=>{let o=n.url.match(a)[1]??null;null!=o&&-1!==o.indexOf(d.web_app_prefix+t)&&(-1!==n.url.indexOf("https://"+d.web_app_prefix+t+"/")||-1!==n.url.indexOf("https://beta_"+d.web_app_prefix+t+"/"))&&(f.Local.migration_status=!0,e.target={tabId:n.id},await l.Browser().scripting.executeScript(e),f.Local.migration_status=!1,await l.Browser().storage.local.set({migration_status:!1}))}))}))}))}};getHistories=(e=!1)=>new Promise((t=>l.Browser().storage.local.get("histories").then((a=>typeof a.histories<"u"&&0==e&&null!=a.histories&&Object.keys(a.histories).length>0?t(a.histories):l.apiCall("/extensions/app/get_history",null,"POST").then((async e=>{if(l.notUndefined(e,"all_histories")){let t=l.notUndefined(e,"all_histories");return t&&(t=l.getHistoryFixer(t)),l.Browser().storage.local.set({histories:t}),t}}))))));getActiveHistories=async(e={})=>{let t=await l.Browser().storage.local.get("ai_chat_ids")??{};return t.ai_chat_ids&&(t=t.ai_chat_ids),await l.apiCall("/extensions/app/get_active_history",{chat_ids:t},"POST").then((async e=>{if(l.notUndefined(e,"histories")){let a=l.notUndefined(e,"histories"),n=l.notUndefined(e,"history_ids");a&&(a=l.getHistoryFixer(a));let o=await l.Browser().storage.local.get("ai_single").ai_single??{};o=Object.assign(o,a.ai_single);let i={};return a.ai_chat&&Object.keys(a.ai_chat).length>0&&(i.ai_chat=a.ai_chat),o&&Object.keys(o).length>0&&(i.ai_single=o),n&&Object.keys(n).length>0&&(n=Object.assign(n,t),i.ai_chat_ids=n,f.Local.ai_chat_ids=n),Object.keys(i).length>0&&await l.Browser().storage.local.set(i),f.Local=Object.assign(f.Local,i),{histories:a,history_ids:n}}}))};getHistoryFixer=e=>{let t=this.__("Hello, how can I help you today?");return Object.keys(e).forEach((a=>{l.notUndefined(e,a)&&(l.notUndefined(e[a],"0.role")?"user"==l.notUndefined(e[a],"0.role")&&(e[a]=[{item:t,role:"assistant",model:l.notUndefined(e[a],"0.model"),loading:!1},...Object.values(e[a])]):Object.keys(e[a]).forEach((n=>{l.notUndefined(e[a],n)&&l.notUndefined(e[a][n],"items")&&"user"==l.notUndefined(e[a][n].items,"0.role")&&(e[a][n].items=[{item:t,role:"assistant",model:l.notUndefined(e[a][n].items,"0.model"),loading:!1},...Object.values(e[a][n].items)])})))})),e};getSearchFilter=(e,t=null,a=!1)=>t?Object.values(e).filter((e=>"object"==typeof e?Object.values(e).some((e=>"object"==typeof e&&1==a?JSON.stringify(e).toString().toLowerCase().includes(t.toLowerCase()):e.toString().toLowerCase().includes(t.toLowerCase()))):"string"==typeof e?-1!==e.toLowerCase().indexOf(t.toString().toLowerCase()):void 0)):e;getKeySearch=(e,t=null,a=!1,l=!1)=>{if(!t)return e;let n=null;return n=1==a?{}:[],Object.keys(e).some((o=>{o.toString().toLowerCase().includes(t.toLowerCase())&&(1==a?l?n[o.replace(t,"")]=e[o]:n[o]=e[o]:n.push(o)),o.toString().toLowerCase().includes(t.toLowerCase())})),n};domainByUrls=e=>{l.Browser().storage.local.set({domain:e});let t=d.web_app_prefix+e,a={domain:e,site:`https://${t}`,site_buy_plan:`https://${t}/subscription`,site_payment:`https://${t}/payment`,site_pricing:`https://${t}/pricing`,login:`https://${t}/auth`,api_url:`https://${d.api_mode}.${e}`,download_url:`https://download.${e}`,cdn_url:`https://cdn.${e}`};return d.domain_allows&&-1===d.domain_allows.indexOf(e)&&d.domain_allows.push(e),Object.keys(a).forEach((e=>{d[e]=a[e]})),a};ObjectSorting=(e,t=!0,a=null)=>Object.fromEntries(Object.entries(e).sort((([,e],[,l])=>(null!==a&&(typeof e[a]<"u"&&(Number.isNaN(parseFloat(e[a]))||(e=e[a])),typeof l[a]<"u"&&(Number.isNaN(parseFloat(l[a]))||(l=l[a]))),t?parseFloat(e)-parseFloat(l):parseFloat(l)-parseFloat(e)))));clearStorage=(e=!1)=>{1==e&&(l.Browser().storage.local&&l.Browser().storage.local.clear(),l.Browser().storage.sync&&l.Browser().storage.sync.clear());let t=["token_usage","credits","licences","uuid_hopekey","uuid_search","expires","credit_usage","credit_detail","credit_detail_visual","start_scrap","language_var_sync","language_variables","languages","ai_models","ai_type_models","ai_prompts","selected_ask","selected_question","selected_write","prompt_settings","model_settings","files","faq","packages","developer","domain","draggable_modal_history","ai_chat_ids","ai_contextPrompts","delete_key","ai_single"];l.Browser().storage.local.get().then((e=>{l.Browser().storage.local.remove(l.getKeySearch(e,"ai_single_"))})),console.log(t);let a={ai_single:[l.SHA1("image")]};l.Browser().storage.local.get("delete_key").then((e=>{"object"==typeof e.delete_key&&Object.values(e.delete_key).forEach((e=>{a.ai_single.push(e)}))})),l.Browser().storage.local.get("ai_prompts").then((e=>{let t={};if(typeof e.ai_prompts<"u"){try{t=JSON.parse(e.ai_prompts)}catch{t=e.ai_prompts}let a=[];Object.values(t).forEach((e=>{let t=e.mode;"object"==typeof t&&(t=t.join(",")),-1==a.indexOf("selected_"+t)&&a.push("selected_"+t)})),l.Browser().storage.local.remove(a).then()}})),l.Browser().storage.local.remove(t).then(),Object.keys(a).forEach((e=>{l.Browser().storage.local.get(e).then((t=>{if(typeof t[e]<"u"){let n=!1,o=!1;try{t[e]=JSON.parse(t[e]),o=!0}catch{}let i=a[e];null!==t[e]&&("object"==typeof t[e]?Object.keys(t[e]).forEach((a=>{-1===i.indexOf(a)&&(n=!0,delete t[e][a])})):(n=!0,delete t[e])),o&&(t[e]=JSON.stringify(t[e])),n&&l.Browser().storage.local.set(t).then()}}))})),l.Browser().storage.local.remove(["ai_setup"]).then(),l.Browser().storage.local.set({show_sidebar:!1}).then(),console.log("clearStorage")};promptIdByGetValues=e=>{let t=f.Local.prompt_settings,a=f.Local.model_settings,n={};return t&&(Object.keys(t).forEach((o=>{if(-1!==o.indexOf(e)){let e=o.split("-_-"),i=e[0],s=t[o],r=l.notUndefined(a,`${i}`),c=l.notUndefined(r,`items.${s}`),d=l.notUndefined(c,"title");n[o]={name:r.title,id:e[0]??null,value:s,priority:e[1].split("_")[1]??0,title:d??i}}})),n=l.ObjectSorting(n,!0,"priority")),n};emptyResolve=()=>new Promise(((e,t)=>{}));onSettingTypeByValue(e,t){if(e&&typeof e.type<"u"){if(typeof e.mode<"u"&&"attribute"==e.mode)return t.getAttribute(e.type);if(typeof t[e.type]<"u")return t[e.type]}}emailSuggestion=async(e,t,a)=>{let n=this.MD5(e);return l.Browser().storage.local.get("email_suggestions").then((async o=>l.notUndefined(o,"email_suggestions."+n)?l.notUndefined(o,"email_suggestions."+n):await this.apiCall("/ai/email_suggestion",{text:e,history:t,extra_data:a},"POST").then((e=>(o[n]=e,e)))))};positionByScreenCalc(e,t=10){let a=Math.max(-1,Math.min(e.top,window.innerHeight-(e.top+e.height+t)));a=a<=0?-(e.height+t):e.height+t;let l=Math.max(-1,Math.min(e.top,window.innerWidth-(e.top+e.width+t)));return l=l<=0?-(e.width+t):e.width+t,{top:a,left:l}}getYtSummarize(){console.log("Başladım");let e="",t=null;if(typeof window<"u"&&window.location&&-1!==window.location.host.indexOf("youtube.")){t=window.ytInitialPlayerResponse??null,null===t&&document.querySelectorAll("body script").forEach((e=>{if(e){let a=e;if(-1!==a.innerText.indexOf("var ytInitialPlayerResponse"))try{t=JSON.parse(a.innerText.match("{.*:{.*:.*}}")[0])}catch{}}}));let a=f.Local.settings.language,n=null==t?void 0:t.captions.playerCaptionsTracklistRenderer.captionTracks,o=null;n&&(n.forEach((e=>{a===e.languageCode&&(o=l.notUndefined(e,"baseUrl"))})),null==o&&(o=l.notUndefined(n,"0.baseUrl")));let i=[];null!==o&&t&&fetch(o).then((e=>e.text())).then((n=>{let s={compact:!1,ignoreComment:!0,spaces:4};n=l.JsonParse(ne.xml2json(n,s))??n;let r=l.notUndefined(n,"elements.0.elements");r&&r.forEach(((t,a)=>{let n={text:"",start:l.notUndefined(t,"attributes.start"),dur:l.notUndefined(t,"attributes.dur")},o=l.notUndefined(t,"elements");o&&o.forEach(((e,t)=>{n.text+=0!==t?" "+e.text:e.text})),e+=0!=a?n.text+" ":n.text,i.push(n)})),console.log(i),console.log(t,o),console.log(null==t?void 0:t.captions.playerCaptionsTracklistRenderer.captionTracks),console.log(a),console.log(e)}))}}eventMarkedInText(){document.querySelector(".aitopia").addEventListener("mouseover",(e=>{let t=e.target.closest("pre code");if(null!=t&&null===t.querySelector(".ait-code-toolbox")&&null===t.querySelector(".ait-pre-header")){let e=t.innerText,a=document.createElement("div");a.classList.add("ait-code-toolbox");let n=document.createElement("button");n.value=l.__("Copy"),n.classList.add("ait-code-copy"),n.setAttribute("data-content",e),n.textContent=n.value,a.append(n);let o=document.createElement("button");o.value=l.__("Download"),o.classList.add("ait-code-download"),o.setAttribute("data-content",e);let i=Object.values(t.classList).join(" ");o.setAttribute("data-type",i.replace(/hljs language-/g,"")),o.textContent=o.value,a.append(o),t.append(a)}})),document.querySelector(".aitopia").addEventListener("mouseout",(e=>{null==e.target.closest("pre code")&&(null!=document.querySelector(".ait-code-toolbox")?document.querySelector(".ait-code-toolbox").remove():null!=document.querySelector(".ait-pre-header")?document.querySelector(".ait-pre-header").remove():(null!=document.querySelector(".ait-code-copy")&&document.querySelector(".ait-code-copy").remove(),null!=document.querySelector(".ait-code-download")&&document.querySelector(".ait-code-download").remove()))})),document.querySelector(".aitopia").addEventListener("click",(e=>{var t,a;let n=e.target;null!=(t=n.classList)&&t.contains("ait-code-copy")&&l.copyClipboard(n.getAttribute("data-content")),null!=(a=n.classList)&&a.contains("ait-code-download")&&l.downloadContent(n.getAttribute("data-content"),"plain/text","aitopia_"+Date.now()+"."+n.getAttribute("data-type"));let o=n.getAttribute("href");if(o&&-1!==o.indexOf("#")&&n.closest(".aitopia .ai_result")){let t=n.innerText;n.closest(".aitopia .ai_result").querySelectorAll("h1,h2,h3,h4,h5,h6").forEach((a=>{(a.textContent.includes(t)||a.textContent.includes(o.replace(/-/," ").replace("#","")))&&(a.scrollIntoView(),e.stopPropagation(),e.preventDefault())}))}}))}downloadContent(e,t,a){const l=document.createElement("a"),n=new Blob([e],{type:t}),o=URL.createObjectURL(n);l.setAttribute("href",o),l.setAttribute("download",a),l.click(),this.notify&&this.notify.success(a+" "+this.__("Downloaded."))}encodeHTML(e){return e.replace(/([\u00A0-\u9999<>&])(.|$)/g,(function(e,t,a){return"&"!==t||"#"!==a?(/[\u00A0-\u9999<>&]/.test(a)&&(a="&#"+a.charCodeAt(0)+";"),"&#"+t.charCodeAt(0)+";"+a):e}))}decodeHTML(e){return e.replace(/&#([0-9]+);/g,(function(e,t){return String.fromCharCode(parseInt(t))}))}groupChatListener(){}}Object.defineProperty(String.prototype,"toFirstUpperCase",{value:function(){return this?`${this.substring(0,1).toUpperCase()}${this.substring(1)}`:this}}),Object.defineProperty(String.prototype,"toEscapeHTML",{value:function(){return this?this.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;"):this}}),Object.defineProperty(String.prototype,"toUnEscapeHTML",{value:function(){return this?this.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#39;/g,"'"):this}}),Object.defineProperty(String.prototype,"toCapitalizeCase",{value:function(){if(!this)return this;let e=this.split(" ");return e.forEach(((t,a)=>{e[a]=t.toFirstUpperCase()})),`${e.join(" ")}`}}),Object.defineProperty(Object.prototype,"searchElement",{value:function(e){return this?(l.getSearchFilter(this,e)??[null])[0]??null:this}});const l=new ue;export{G as A,l as H,f as S,C as V,y as a,d as c};